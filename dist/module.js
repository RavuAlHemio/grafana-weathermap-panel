define(["app/plugins/sdk","lodash","app/core/time_series2"],((e,t,r)=>(()=>{"use strict";var n={1:(e,t,r)=>{r.r(t),r.d(t,{PanelCtrl:()=>L});var n=r(256),a="http://www.w3.org/2000/svg";function i(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function o(e,t,r,n){if(null===t){if(null===r){var a=i(e,n);return[e,e,a,a,a,n,n]}t=e}null===r&&(r=n);var o=i(e,t),s=i(t,r),l=i(r,n),p=i(o,s),u=i(s,l);return[e,o,p,i(p,u),u,l,n]}function s(e,t){return null===e&&(e=0),null===t&&(t=0),{x:t*Math.cos(e),y:t*Math.sin(e)}}function l(e){for(;e<=-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e}function p(e){return e*Math.PI/180}var u="pink";function d(e,t,r){return"linear"===e.type?function(e,t,r){if(0===e.length)return u;var n=e[e.length-1],a=0,i=0,o=0;if(r<e[0].position)return""+e[0][t];if(r>=n.position)return""+n[t];for(var s=!1,l=0;l<e.length-1;++l)if(r>=e[l].position&&r<e[l+1].position){var p=e[l].position,d=Number.parseInt((""+e[l][t]).substr(1,2),16),f=Number.parseInt((""+e[l][t]).substr(3,2),16),c=Number.parseInt((""+e[l][t]).substr(5,2),16),y=e[l+1].position,m=Number.parseInt((""+e[l+1][t]).substr(1,2),16),g=Number.parseInt((""+e[l+1][t]).substr(3,2),16),v=Number.parseInt((""+e[l+1][t]).substr(5,2),16);a=h(r,p,y,d,m),i=h(r,p,y,f,g),o=h(r,p,y,c,v),s=!0;break}if(!s)return u;return"rgb("+Math.floor(a)+", "+Math.floor(i)+", "+Math.floor(o)+")"}(e.stops,t,r):"steps"===e.type?function(e,t,r){if(0===e.length)return u;var n=e[e.length-1];if(r<e[0].position)return""+e[0][t];if(r>=n.position)return""+n[t];for(var a=0;a<e.length-1;++a)if(r>=e[a].position&&r<e[a+1].position)return""+e[a][t];return u}(e.stops,t,r):u}function h(e,t,r,n,a){return n===a?n:(e<t&&(e=t),e>r&&(e=r),n+(e-t)/(r-t)*(a-n))}var f=100;function c(e,t,r,n,a,i){var o="";if(""!==t.type){var s=e.g();r.appendChild(s),s.setAttribute("class","stroke-legend"),"h"===t.type[0]?o="translate("+t.x+" "+t.y+") scale("+t.length/f+" "+t.width/5+")":"v"===t.type[0]&&(o="translate("+t.x+" "+(t.y+t.length)+") rotate(-90) scale("+t.length/f+" "+t.width/5+")"),s.setAttribute("transform",o),y(e,a,"strokeColor",s,n,i);var l=e.g();r.appendChild(l),s.setAttribute("class","fill-legend"),"h"===t.type[0]?o="translate("+t.x+" "+(t.y+t.width)+") scale("+t.length/f+" "+t.width/5+")":"v"===t.type[0]&&(o="translate("+(t.x+t.width)+" "+(t.y+t.length)+") rotate(-90) scale("+t.length/f+" "+t.width/5+")"),l.setAttribute("transform",o),y(e,a,"fillColor",l,n,i),function(e,t,r,n){if(""===t.type||"n"===t.type[1])return;for(var a=0,i=r.stops;a<i.length;a++){var o=i[a];if(o.showLegendLabel){var s=t.x,l=t.y,p=0,u="start";"h"===t.type[0]?(s+=o.position*t.length/f,u="middle","hb"===t.type&&(l+=2*t.width,p=1)):"v"===t.type[0]&&(l+=t.length-o.position*t.length/f,p=.4,"vl"===t.type?u="end":"vr"===t.type&&(u="start",s+=2*t.width));var d=e.text();n.appendChild(d),d.setAttribute("class","legend-label"),d.setAttribute("x",""+s),d.setAttribute("y",""+l),d.setAttribute("dy",p+"em"),d.setAttribute("style","text-anchor:"+u),d.textContent=""+o.position}}}(e,t,a,r)}}function y(e,t,r,n,a,i){if("linear"===t.type){var o="WeathermapLegendGradient-"+r;null!=i&&(o=o+"-"+i);var s=e.linearGradient();a.appendChild(s),s.setAttribute("id",o);for(var l=0,p=t.stops;l<p.length;l++){var u=p[l],d=e.stop();s.appendChild(d),d.setAttribute("offset",u.position+"%"),d.setAttribute("stop-color",""+u[r])}var h=e.rect();n.appendChild(h),b(h,0,0,f,5),h.setAttribute("style","fill:url(#"+o+")")}else if("steps"===t.type){for(var c=1;c<t.stops.length;++c){var y=e.rect();n.appendChild(y),b(y,t.stops[c-1].position,0,t.stops[c].position-t.stops[c-1].position,5),y.setAttribute("style","fill:"+t.stops[c-1][r])}var m=e.rect();n.appendChild(m),b(m,t.stops[t.stops.length-1].position,0,100-t.stops[t.stops.length-1].position,5),m.setAttribute("style","fill:"+t.stops[t.stops.length-1][r])}}function m(e,t,r,n,a,i){void 0===i&&(i=!1);var u=r.gradient.stops.slice().sort((function(e,t){return e.position-t.position})),h={type:r.gradient.type,stops:u},f=new k(e,r,h,n);return function(e,t,r){void 0===r&&(r=!1);e.svg=e.make.svg(),x(e.svg,{width:e.config.canvasSize.width+"px",height:e.config.canvasSize.height+"px"}),r&&e.svg.setAttribute("viewBox","0 0 "+e.config.canvasSize.width+" "+e.config.canvasSize.height);t.appendChild(e.svg),e.defs=e.make.defs(),e.svg.appendChild(e.defs),e.legendGroup=e.make.g(),e.legendGroup.setAttribute("class","legend"),e.svg.appendChild(e.legendGroup),e.edgeGroup=e.make.g(),e.edgeGroup.setAttribute("class","edges"),e.svg.appendChild(e.edgeGroup),e.nodeGroup=e.make.g(),e.nodeGroup.setAttribute("class","nodes"),e.svg.appendChild(e.nodeGroup),e.labelGroup=e.make.g(),e.labelGroup.setAttribute("class","labels"),e.svg.appendChild(e.labelGroup)}(f,t,i),null!=a&&(f.nodeLinkUriBase=a(r.link.node),f.edgeLinkUriBase=a(r.link.edge)),function(e){for(var t=0,r=e.config.weathermapNodes;t<r.length;t++){var n=r[t];e.nodeLabelToNode[n.label]=n;var a=e.make.g();v(e.make,e.nodeGroup,a,e.nodeLinkUriBase,n.linkParams);var i=e.make.rect();a.appendChild(i),b(i,n.x,n.y,n.width,n.height),x(i,{stroke:"gray","stroke-width":"1px"});var o=e.make.text();if(a.appendChild(o),o.setAttribute("x",""+(+n.x+ +e.config.textOffsets.left)),o.setAttribute("y",""+(+n.y+ +n.height-e.config.textOffsets.bottom)),e.config.showNumbers&&null!=n.metricName){var s=n.metricName in e.currentValues?""+e.currentValues[n.metricName]:"?";o.textContent=n.label+" ("+s+")"}else o.textContent=n.label;var l=null;if(n.metricName?n.metricName in e.currentValues?(l=e.currentValues[n.metricName],x(i,{fill:d(e.sortedGradient,"fillColor",l)})):(x(o,{fill:"white"}),x(i,{fill:"black","stroke-dasharray":e.config.noValueDashArray})):x(i,{fill:"silver","stroke-dasharray":e.config.unmeasuredDashArray}),null!==l){var p=e.make.title();a.insertBefore(p,p.firstChild),p.textContent=n.label+" ("+l.toFixed(2)+")"}}}(f),function(e){for(var t=0,r=e.config.weathermapEdges;t<r.length;t++){var n=r[t],a=e.nodeLabelToNode[n.node1],i=e.nodeLabelToNode[n.node2];if(a&&i){var u=e.make.g();v(e.make,e.edgeGroup,u,e.edgeLinkUriBase,n.linkParams);var d={x:+a.x+ +a.width/2,y:+a.y+ +a.height/2},h={x:+i.x+ +i.width/2,y:+i.y+ +i.height/2},f=null,c=null;if(n.bendDirection&&n.bendMagnitude){var y=Math.atan2(d.y-h.y,h.x-d.x),m=Math.atan2(h.y-d.y,d.x-h.x),b=l(y+p(n.bendDirection)),x=l(m-p(n.bendDirection)),w=s(b,n.bendMagnitude),k=s(x,n.bendMagnitude);f={x:+d.x+w.x,y:+d.y-w.y},c={x:+h.x+k.x,y:+h.y-k.y}}if(n.metric2Name){var C=o(d,f,c,h),N=C[1],A=C[2],S=C[3],G=C[4],E=C[5];g(e,u,d,N,A,S,n.metricName,n.styleName,n.node1+" → "+n.node2),g(e,u,S,G,E,h,n.metric2Name,n.styleName,n.node2+" → "+n.node1)}else g(e,u,d,f,c,h,n.metricName,n.styleName,n.node1+" ↔ "+n.node2)}}}(f),function(e){for(var t=0,r=e.config.weathermapLabels;t<r.length;t++){var n=r[t],a=e.make.g();e.labelGroup.appendChild(a);var i=e.make.text();a.appendChild(i),i.setAttribute("x",""+ +n.x),i.setAttribute("y",""+ +n.y),i.textContent=n.label}}(f),c(f.make,r.legend,f.legendGroup,f.defs,h,""+r.id),f.svg}function g(e,t,r,n,a,i,s,l,p){var u=[e.config.strokeWidth],h=function(e,t){if(!t)return null;var r=e.styleMap[t];if(!r)return null;return r}(e,l);h&&h.strokeWidthArray&&(u=h.strokeWidthArray.split(/[ ,]+/).map((function(e){return Number.parseFloat(e)})));u.length%2!=1&&u.push.apply(u,u);var f,c,y={x:0,y:0};if(u.length>1){var m={x:r.x-i.x,y:r.y-i.y};f={x:m.y,y:-m.x},c=Math.sqrt(f.x*f.x+f.y*f.y),y={x:f.x/c,y:f.y/c}}var g=e.make.g();t.appendChild(g),x(g,{fill:"none"});var v=null;if(null!=s&&s in e.currentValues?(v=e.currentValues[s],x(g,{stroke:d(e.sortedGradient,"strokeColor",v)}),function(e,t,r){if(!r)return;var n={};r.dashArray&&(n["stroke-dasharray"]=r.dashArray);x(t,n)}(0,g,h)):x(g,{stroke:"black","stroke-dasharray":e.config.noValueDashArray}),p){var b=e.make.title();g.appendChild(b),b.textContent=null===v?p:p+" ("+v.toFixed(2)+")"}for(var w=-u.reduce((function(e,t){return e+t}),0)/2,k=!0,C=0,N=u;C<N.length;C++){var A=N[C];if(k=!k)w+=A;else{var S=y.x*(w+A/2),G=y.y*(w+A/2),E={x:r.x+S,y:r.y+G},M=null==n?null:{x:n.x+S,y:n.y+G},L=null==a?null:{x:a.x+S,y:a.y+G},U={x:i.x+S,y:i.y+G},P=e.make.path();g.appendChild(P),null==M||null==L?P.setAttribute("d","M "+E.x+","+E.y+" L "+U.x+","+U.y):P.setAttribute("d","M "+E.x+","+E.y+" C "+M.x+","+M.y+","+L.x+","+L.y+","+U.x+","+U.y),x(P,{"stroke-width":""+A}),w+=A}}if(e.config.showNumbers){var O=o(r,n,a,i)[3],I=null!=s&&s in e.currentValues?e.currentValues[s].toFixed(2):"?",D=e.make.text();t.appendChild(D),D.setAttribute("x",""+O.x),D.setAttribute("y",""+O.y),D.textContent=I}}function v(e,t,r,n,a){if(null!=n){var i=n;null!=a&&(i+=-1===i.indexOf("?")?"?":"&",i+=a);var o=e.a();t.appendChild(o),o.setAttributeNS("http://www.w3.org/1999/xlink","href",i),o.appendChild(r)}else t.appendChild(r)}function b(e,t,r,n,a){e.setAttribute("x",""+t),e.setAttribute("y",""+r),e.setAttribute("width",""+n),e.setAttribute("height",""+a)}function x(e,t){var r={};if(e.hasAttribute("style")){var n=e.getAttribute("style");if(null!=n)for(var a=0,i=n.split(";");a<i.length;a++){var o=i[a],s=o.indexOf(":");if(-1!==s){var l=o.substr(0,s),p=o.substr(s+1);r[l]=p}}}for(var l in t)t.hasOwnProperty(l)&&(null===t[l]?delete r[l]:r[l]=t[l]);var u=[];for(var l in r)r.hasOwnProperty(l)&&u.push(l+":"+r[l]);var d=u.join(";");e.setAttribute("style",d)}var w,k=function(e,t,r,n){if(this.make=new C(e),this.config=t,this.sortedGradient=r,this.currentValues=n,this.nodeLabelToNode={},this.nodeLinkUriBase=null,this.edgeLinkUriBase=null,this.svg=null,this.defs=null,this.edgeGroup=null,this.nodeGroup=null,this.labelGroup=null,this.legendGroup=null,this.styleMap={},t.weathermapStyles)for(var a=0,i=t.weathermapStyles;a<i.length;a++){var o=i[a];this.styleMap[o.name]=o}},C=function(){function e(e){this.maker=e}return e.prototype.a=function(){return this.maker.createElementNS(a,"a")},e.prototype.defs=function(){return this.maker.createElementNS(a,"defs")},e.prototype.g=function(){return this.maker.createElementNS(a,"g")},e.prototype.linearGradient=function(){return this.maker.createElementNS(a,"linearGradient")},e.prototype.path=function(){return this.maker.createElementNS(a,"path")},e.prototype.rect=function(){return this.maker.createElementNS(a,"rect")},e.prototype.stop=function(){return this.maker.createElementNS(a,"stop")},e.prototype.svg=function(){return this.maker.createElementNS(a,"svg")},e.prototype.text=function(){return this.maker.createElementNS(a,"text")},e.prototype.title=function(){return this.maker.createElementNS(a,"title")},e}(),N=r(804),A=r.n(N),S=r(840),G=r.n(S),E=(w=function(e,t){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),M={weathermapNodes:[],weathermapEdges:[],weathermapLabels:[],weathermapStyles:[],canvasSize:{width:800,height:600},textOffsets:{left:5,bottom:5},showNumbers:!1,valueName:"max",nullPointMode:"connected",strokeWidth:1,gradient:{type:"steps",stops:[]},legend:{type:"",x:0,y:0,length:100,width:5},link:{node:{type:"none",absoluteUri:null,dashboard:null,dashUri:null},edge:{type:"none",absoluteUri:null,dashboard:null,dashUri:null}},noValueDashArray:"4 4",unmeasuredDashArray:"4 2"},L=function(e){function t(t,r,n){var a=e.call(this,t,r)||this;return a.backendSrv=n,A().defaultsDeep(a.panel,M),a.currentValues={},a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-snapshot-load",a.onDataSnapshotLoad.bind(a)),a.searchDashboards=function(e,t){n.search({query:e}).then((function(e){var r=A().map(e,(function(e){return e.title}));t(r)}))},a}return t.$inject=["$scope","$injector","backendSrv"],E(t,e),t.prototype.onInitEditMode=function(){this.addEditorTab("Options","public/plugins/ravualhemio-weathermap-panel/partials/editor.html",2),this.addEditorTab("Nodes","public/plugins/ravualhemio-weathermap-panel/partials/nodeEditor.html",3),this.addEditorTab("Edges","public/plugins/ravualhemio-weathermap-panel/partials/edgeEditor.html",4),this.addEditorTab("Labels","public/plugins/ravualhemio-weathermap-panel/partials/labelEditor.html",5),this.addEditorTab("Styles","public/plugins/ravualhemio-weathermap-panel/partials/styleEditor.html",6)},t.prototype.onDataReceived=function(e){this.currentSeries=e.map(this.seriesHandler.bind(this)),this.currentValues=this.parseSeries(this.currentSeries),this.render()},t.prototype.seriesHandler=function(e){var t=new(G())({datapoints:e.datapoints,alias:e.target});return t.getFlotPairs(this.panel.nullPointMode),t},t.prototype.parseSeries=function(e){for(var t={},r=0,n=e;r<n.length;r++){var a=n[r];t[a.alias]=a.stats[this.panel.valueName]}return t},t.prototype.onDataSnapshotLoad=function(e){this.onDataReceived(e)},t.prototype.addWeathermapNode=function(e){this.panel.weathermapNodes.push(e||{})},t.prototype.removeWeathermapNode=function(e){this.panel.weathermapNodes=A().without(this.panel.weathermapNodes,e),this.refresh()},t.prototype.addWeathermapEdge=function(e){this.panel.weathermapEdges.push(e||{})},t.prototype.removeWeathermapEdge=function(e){this.panel.weathermapEdges=A().without(this.panel.weathermapEdges,e),this.refresh()},t.prototype.addWeathermapLabel=function(e){this.panel.weathermapLabels.push(e||{})},t.prototype.removeWeathermapLabel=function(e){this.panel.weathermapLabels=A().without(this.panel.weathermapLabels,e),this.refresh()},t.prototype.addWeathermapStyle=function(e){this.panel.weathermapStyles.push(e||{})},t.prototype.removeWeathermapStyle=function(e){this.panel.weathermapStyles=A().without(this.panel.weathermapStyles,e),this.refresh()},t.prototype.addGradientStop=function(e){this.panel.gradient.stops.push(e||{})},t.prototype.onGradientStopStrokeColorChange=function(e){var t=this;return function(r){t.panel.gradient.stops[e].strokeColor=r,t.refresh()}},t.prototype.onGradientStopFillColorChange=function(e){var t=this;return function(r){t.panel.gradient.stops[e].fillColor=r,t.refresh()}},t.prototype.removeGradientStop=function(e){this.panel.gradient.stops=A().without(this.panel.gradient.stops,e),this.refresh()},t.prototype.dashboardChanged=function(e){this.backendSrv.search({query:e.dashboard}).then((function(t){var r=A().find(t,{title:e.dashboard});r&&(e.dashUri=r.uri)}))},t.prototype.link=function(e,t,r,n){var a=this;this.events.on("render",(function(){return a.renderThat(t[0],n)}))},t.prototype.renderThat=function(e,r){var n=e.querySelector("div.weathermap");if(null!==n){for(;n.lastChild;)n.removeChild(n.lastChild);m(document,n,this.panel,this.currentValues,t.resolveLink)}},t.resolveLink=function(e){if("absolute"===e.type&&e.absoluteUri)return e.absoluteUri;if("dashboard"===e.type&&e.dashUri){var t=function(e){var t=e.search;for(;t.startsWith("?");)t=t.substr(1);var r={};if(t.length>0)for(var n=0,a=t.split("&");n<a.length;n++){var i=a[n].match(/^([^=]*)(?:=(.*))?$/);if(null!==i){var o=i[1],s=i[2];void 0!==o&&void 0!==s&&(r[decodeURIComponent(o)]=decodeURIComponent(s))}}return r}(new URL(window.location.href)),r=[];t.from&&r.push("from="+encodeURIComponent(t.from)),t.to&&r.push("to="+encodeURIComponent(t.to));var n="";return r.length>0&&(n="?"+r.join("&")),"/dashboard/"+e.dashUri+n}return null},t}(n.MetricsPanelCtrl);L.templateUrl="partials/module.html"},840:e=>{e.exports=r},256:t=>{t.exports=e},804:e=>{e.exports=t}},a={};function i(e){if(a[e])return a[e].exports;var t=a[e]={exports:{}};return n[e](t,t.exports,i),t.exports}return i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(1)})()));
//# sourceMappingURL=module.js.map