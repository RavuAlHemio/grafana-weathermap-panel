{"version":3,"file":"genwmap.js","mappings":"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","sources":["webpack:///./svg-weathermap/constants.ts","webpack:///./svg-weathermap/geometry.ts","webpack:///./svg-weathermap/gradients.ts","webpack:///./svg-weathermap/legend.ts","webpack:///./svg-weathermap/weathermap.ts","webpack:///external node-commonjs \"http\"","webpack:///./genwmap/fetcher.ts","webpack:///external node-commonjs \"fs\"","webpack:///./genwmap/app.ts","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/conventions.js","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/dom-parser.js","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/dom.js","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/entities.js","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/index.js","webpack:///../.yarn/cache/@xmldom-xmldom-npm-0.8.2-dbf61336d0-aeea8f670b.zip/node_modules/@xmldom/xmldom/lib/sax.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./genwmap/index.js"],"sourcesContent":["export const svgNamespace: string = \"http://www.w3.org/2000/svg\";\r\nexport const xlinkNamespace: string = \"http://www.w3.org/1999/xlink\";\r\n","export function midpoint(point1: Point2D, point2: Point2D): Point2D {\r\n    return {\r\n        x: (point1.x + point2.x)/2.0,\r\n        y: (point1.y + point2.y)/2.0\r\n    };\r\n}\r\n\r\nexport function halveCubicBezier(\r\n    point1: Point2D, control1: Point2D|null, control2: Point2D|null, point2: Point2D\r\n): [Point2D, Point2D, Point2D, Point2D, Point2D, Point2D, Point2D] {\r\n    if (control1 === null) {\r\n        if (control2 === null) {\r\n            // naïveté!\r\n            let straightMidpoint: Point2D = midpoint(point1, point2);\r\n            return [point1, point1, straightMidpoint, straightMidpoint, straightMidpoint, point2, point2];\r\n        }\r\n\r\n        control1 = point1;\r\n    }\r\n    if (control2 === null) {\r\n        control2 = point2;\r\n    }\r\n\r\n    let m1: Point2D = midpoint(point1, control1);\r\n    let m2: Point2D = midpoint(control1, control2);\r\n    let m3: Point2D = midpoint(control2, point2);\r\n\r\n    let q1: Point2D = midpoint(m1, m2);\r\n    let q2: Point2D = midpoint(m2, m3);\r\n\r\n    let o: Point2D = midpoint(q1, q2);\r\n\r\n    return [point1, m1, q1, o, q2, m3, point2];\r\n}\r\n\r\nexport function polarToCartesian(angleRadians: number|null, length: number|null): Point2D {\r\n    if (angleRadians === null) {\r\n        angleRadians = 0;\r\n    }\r\n    if (length === null) {\r\n        length = 0;\r\n    }\r\n\r\n    return {\r\n        x: length * Math.cos(angleRadians),\r\n        y: length * Math.sin(angleRadians)\r\n    };\r\n}\r\n\r\nexport function normalizeAngle(angleRadians: number): number {\r\n    while (angleRadians <= -Math.PI) {\r\n        angleRadians += 2 * Math.PI;\r\n    }\r\n    while (angleRadians > Math.PI) {\r\n        angleRadians -= 2 * Math.PI;\r\n    }\r\n    return angleRadians;\r\n}\r\n\r\nexport function unitVector(vector: Point2D): Point2D {\r\n    let euclidNorm: number = Math.sqrt(vector.x*vector.x + vector.y*vector.y);\r\n    return {\r\n        x: vector.x / euclidNorm,\r\n        y: vector.y / euclidNorm\r\n    };\r\n}\r\n\r\nexport function deg2rad(angleDegrees: number): number {\r\n    return angleDegrees * Math.PI / 180;\r\n}\r\n\r\nexport function rad2deg(angleRadians: number): number {\r\n    return angleRadians * 180 / Math.PI;\r\n}\r\n\r\nexport interface Point2D {\r\n    x: number;\r\n    y: number;\r\n}\r\n","const emergencyColor: string = \"pink\";\r\n\r\nexport function gradientColorForValue(gradient: Gradient, colorType: keyof GradientStop, value: number): string {\r\n    if (gradient.type === \"linear\") {\r\n        return linearColorForValue(gradient.stops, colorType, value);\r\n    } else if (gradient.type === \"steps\") {\r\n        return stepColorForValue(gradient.stops, colorType, value);\r\n    }\r\n    return emergencyColor;\r\n}\r\n\r\nfunction linearColorForValue(stops: GradientStop[], colorType: keyof GradientStop, value: number): string {\r\n    if (stops.length === 0) {\r\n        return emergencyColor;\r\n    }\r\n\r\n    let lastStop: GradientStop = stops[stops.length-1];\r\n    let r: number = 0.0, g: number = 0.0, b: number = 0.0;\r\n    if (value < stops[0].position) {\r\n        return `${stops[0][colorType]}`;\r\n    } else if (value >= lastStop.position) {\r\n        return `${lastStop[colorType]}`;\r\n    } else {\r\n        let foundMatch: boolean = false;\r\n        for (let i: number = 0; i < stops.length-1; ++i) {\r\n            if (value >= stops[i].position && value < stops[i+1].position) {\r\n                // found!\r\n\r\n                let posFrom: number = stops[i].position;\r\n                let rFrom: number = Number.parseInt(`${stops[i][colorType]}`.substr(1, 2), 16);\r\n                let gFrom: number = Number.parseInt(`${stops[i][colorType]}`.substr(3, 2), 16);\r\n                let bFrom: number = Number.parseInt(`${stops[i][colorType]}`.substr(5, 2), 16);\r\n\r\n                let posTo: number = stops[i+1].position;\r\n                let rTo: number = Number.parseInt(`${stops[i+1][colorType]}`.substr(1, 2), 16);\r\n                let gTo: number = Number.parseInt(`${stops[i+1][colorType]}`.substr(3, 2), 16);\r\n                let bTo: number = Number.parseInt(`${stops[i+1][colorType]}`.substr(5, 2), 16);\r\n\r\n                r = lerp(value, posFrom, posTo, rFrom, rTo);\r\n                g = lerp(value, posFrom, posTo, gFrom, gTo);\r\n                b = lerp(value, posFrom, posTo, bFrom, bTo);\r\n\r\n                foundMatch = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!foundMatch) {\r\n            return emergencyColor;\r\n        }\r\n    }\r\n\r\n    return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;\r\n}\r\n\r\nfunction stepColorForValue(stops: GradientStop[], colorType: keyof GradientStop, value: number): string {\r\n    if (stops.length === 0) {\r\n        return emergencyColor;\r\n    }\r\n\r\n    let lastStop: GradientStop = stops[stops.length-1];\r\n    if (value < stops[0].position) {\r\n        return `${stops[0][colorType]}`;\r\n    } else if (value >= lastStop.position) {\r\n        return `${lastStop[colorType]}`;\r\n    } else {\r\n        for (let i: number = 0; i < stops.length-1; ++i) {\r\n            if (value >= stops[i].position && value < stops[i+1].position) {\r\n                return `${stops[i][colorType]}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    return emergencyColor;\r\n}\r\n\r\nfunction lerp(value: number, sourceMin: number, sourceMax: number, targetMin: number, targetMax: number): number {\r\n    if (targetMin === targetMax) {\r\n        return targetMin;\r\n    }\r\n\r\n    if (value < sourceMin) {\r\n        value = sourceMin;\r\n    }\r\n    if (value > sourceMax) {\r\n        value = sourceMax;\r\n    }\r\n\r\n    let terp: number = (value - sourceMin) / (sourceMax - sourceMin);\r\n    return targetMin + terp * (targetMax - targetMin);\r\n}\r\n\r\n\r\nexport interface GradientStop {\r\n    position: number;\r\n    strokeColor: string;\r\n    fillColor: string;\r\n    showLegendLabel: boolean;\r\n}\r\n\r\nexport interface Gradient {\r\n    type: \"steps\"|\"linear\";\r\n    stops: GradientStop[];\r\n}\r\n","import { Gradient, GradientStop } from \"./gradients\";\r\nimport { SVGElementCreator, setRectangleDimensions } from \"./weathermap\";\r\n\r\nconst legendLength: number = 100;\r\nconst legendWidth: number = 5;\r\n// (let the container apply any transformations)\r\n\r\nexport function placeLegend(\r\n    svgMake: SVGElementCreator, settings: LegendSettings, container: Element, defs: SVGDefsElement, gradient: Gradient,\r\n    weathermapID?: string|null\r\n): void {\r\n    let transform: string = \"\";\r\n\r\n    if (settings.type === \"\") {\r\n        // no legend\r\n        return;\r\n    }\r\n\r\n    // draw stroke-color legend\r\n    let strokeLegendContainer: SVGGElement = svgMake.g();\r\n    container.appendChild(strokeLegendContainer);\r\n    strokeLegendContainer.setAttribute(\"class\", \"stroke-legend\");\r\n    if (settings.type[0] === \"h\") {\r\n        transform =\r\n            `translate(${settings.x} ${settings.y})`\r\n            + ` scale(${settings.length/legendLength} ${settings.width/legendWidth})`\r\n        ;\r\n    } else if (settings.type[0] === \"v\") {\r\n        transform =\r\n            `translate(${settings.x} ${settings.y + settings.length})`\r\n            + ` rotate(-90)`\r\n            + ` scale(${settings.length/legendLength} ${settings.width/legendWidth})`\r\n        ;\r\n    }\r\n    strokeLegendContainer.setAttribute(\"transform\", transform);\r\n    drawLegend(svgMake, gradient, \"strokeColor\", strokeLegendContainer, defs, weathermapID);\r\n\r\n    // draw fill-color legend\r\n    let fillLegendContainer: SVGGElement = svgMake.g();\r\n    container.appendChild(fillLegendContainer);\r\n    strokeLegendContainer.setAttribute(\"class\", \"fill-legend\");\r\n    if (settings.type[0] === \"h\") {\r\n        transform =\r\n            `translate(${settings.x} ${settings.y + settings.width})`\r\n            + ` scale(${settings.length/legendLength} ${settings.width/legendWidth})`\r\n        ;\r\n    } else if (settings.type[0] === \"v\") {\r\n        transform =\r\n            `translate(${settings.x + settings.width} ${settings.y + settings.length})`\r\n            + ` rotate(-90)`\r\n            + ` scale(${settings.length/legendLength} ${settings.width/legendWidth})`\r\n        ;\r\n    }\r\n    fillLegendContainer.setAttribute(\"transform\", transform);\r\n    drawLegend(svgMake, gradient, \"fillColor\", fillLegendContainer, defs, weathermapID);\r\n\r\n    // draw legend labels\r\n    placeLabels(svgMake, settings, gradient, container);\r\n}\r\n\r\nfunction drawLegend(\r\n    svgMake: SVGElementCreator, gradient: Gradient, colorType: keyof GradientStop, container: SVGElement,\r\n    defs: SVGDefsElement, weathermapID?: string|null\r\n): void {\r\n    if (gradient.type === \"linear\") {\r\n        let legendGradientName: string = `WeathermapLegendGradient-${colorType}`;\r\n        if (weathermapID != null) {\r\n            legendGradientName = `${legendGradientName}-${weathermapID}`;\r\n        }\r\n\r\n        let svgGrad: SVGLinearGradientElement = svgMake.linearGradient();\r\n        defs.appendChild(svgGrad);\r\n        svgGrad.setAttribute(\"id\", legendGradientName);\r\n\r\n        for (let stop of gradient.stops) {\r\n            let svgStop: SVGStopElement = svgMake.stop();\r\n            svgGrad.appendChild(svgStop);\r\n            svgStop.setAttribute(\"offset\", `${stop.position}%`);\r\n            svgStop.setAttribute(\"stop-color\", `${stop[colorType]}`);\r\n        }\r\n\r\n        let svgRect: SVGRectElement = svgMake.rect();\r\n        container.appendChild(svgRect);\r\n        setRectangleDimensions(svgRect, 0, 0, legendLength, legendWidth);\r\n        svgRect.setAttribute(\"style\", `fill:url(#${legendGradientName})`);\r\n    } else if (gradient.type === \"steps\") {\r\n        for (let i: number = 1; i < gradient.stops.length; ++i) {\r\n            let rect: SVGRectElement = svgMake.rect();\r\n            container.appendChild(rect);\r\n\r\n            setRectangleDimensions(rect,\r\n                gradient.stops[i-1].position,\r\n                0,\r\n                gradient.stops[i].position - gradient.stops[i-1].position,\r\n                legendWidth\r\n            );\r\n            rect.setAttribute(\"style\", `fill:${gradient.stops[i-1][colorType]}`);\r\n        }\r\n        let rect: SVGRectElement = svgMake.rect();\r\n        container.appendChild(rect);\r\n        setRectangleDimensions(rect,\r\n            gradient.stops[gradient.stops.length-1].position,\r\n            0,\r\n            100 - gradient.stops[gradient.stops.length-1].position,\r\n            legendWidth\r\n        );\r\n        rect.setAttribute(\"style\", `fill:${gradient.stops[gradient.stops.length-1][colorType]}`);\r\n    }\r\n}\r\n\r\nfunction placeLabels(svgMake: SVGElementCreator, settings: LegendSettings, gradient: Gradient, container: Element): void {\r\n    if (settings.type === \"\" || settings.type[1] === \"n\") {\r\n        // no labels\r\n        return;\r\n    }\r\n\r\n    for (let stop of gradient.stops) {\r\n        if (!stop.showLegendLabel) {\r\n            continue;\r\n        }\r\n\r\n        let xCoord: number = settings.x;\r\n        let yCoord: number = settings.y;\r\n        let dy: number = 0.0;\r\n        let textAnchor: \"start\"|\"middle\"|\"end\" = \"start\";\r\n\r\n        if (settings.type[0] === \"h\") {\r\n            // horizontal scale\r\n            xCoord += stop.position * settings.length / legendLength;\r\n\r\n            textAnchor = \"middle\";\r\n            if (settings.type === \"hb\") {\r\n                yCoord += 2 * settings.width;\r\n                dy = 1.0;\r\n            }\r\n        } else if (settings.type[0] === \"v\") {\r\n            // vertical scale\r\n            yCoord += settings.length - (stop.position * settings.length / legendLength);\r\n            dy = 0.4;\r\n\r\n            if (settings.type === \"vl\") {\r\n                textAnchor = \"end\";\r\n            } else if (settings.type === \"vr\") {\r\n                textAnchor = \"start\";\r\n                xCoord += 2 * settings.width;\r\n            }\r\n        }\r\n\r\n        let label: SVGTextElement = svgMake.text();\r\n        container.appendChild(label);\r\n        label.setAttribute(\"class\", \"legend-label\");\r\n        label.setAttribute(\"x\", `${xCoord}`);\r\n        label.setAttribute(\"y\", `${yCoord}`);\r\n        label.setAttribute(\"dy\", `${dy}em`);\r\n        label.setAttribute(\"style\", `text-anchor:${textAnchor}`);\r\n        label.textContent = `${stop.position}`;\r\n    }\r\n}\r\n\r\nexport interface LegendSettings {\r\n    type: \"\"|\"hn\"|\"ha\"|\"hb\"|\"vn\"|\"vl\"|\"vr\";\r\n    x: number;\r\n    y: number;\r\n    length: number;\r\n    width: number;\r\n}\r\n","import { svgNamespace, xlinkNamespace } from \"./constants\";\r\nimport { deg2rad, halveCubicBezier, normalizeAngle, Point2D, polarToCartesian, unitVector } from \"./geometry\";\r\nimport { Gradient, GradientStop, gradientColorForValue } from \"./gradients\";\r\nimport { LegendSettings, placeLegend } from \"./legend\";\r\n\r\nexport function renderWeathermapInto(\r\n    elementCreator: SVGElementCreatorDOM, container: Node, config: WeathermapConfig, currentValues: MetricValueMap,\r\n    linkResolver: ((linkSettings: ObjectLinkSettings) => string|null)|null|undefined, addViewBox: boolean = false\r\n): SVGSVGElement {\r\n    // sort gradient stops\r\n    let sortedStops: GradientStop[] = config.gradient.stops\r\n        .slice()\r\n        .sort((l, r) => l.position - r.position);\r\n    let sortedGradient: Gradient = {\r\n        type: config.gradient.type,\r\n        stops: sortedStops\r\n    };\r\n\r\n    let state = new WeathermapRendererState(elementCreator, config, sortedGradient, currentValues);\r\n\r\n    initializeSVG(state, container, addViewBox);\r\n\r\n    // resolve links\r\n    if (linkResolver != null) {\r\n        state.nodeLinkUriBase = linkResolver(config.link.node);\r\n        state.edgeLinkUriBase = linkResolver(config.link.edge);\r\n    }\r\n\r\n    // emplacement\r\n    placeNodes(state);\r\n    placeEdges(state);\r\n    placeLabels(state);\r\n    placeLegend(state.make, config.legend, state.legendGroup!, state.defs!, sortedGradient, `${config.id}`);\r\n\r\n    return state.svg!;\r\n}\r\n\r\nfunction initializeSVG(state: WeathermapRendererState, container: Node, addViewBox: boolean = false): void {\r\n    // add SVG\r\n    state.svg = state.make.svg();\r\n    modifyStyle(state.svg, {\r\n        \"width\": `${state.config.canvasSize.width}px`,\r\n        \"height\": `${state.config.canvasSize.height}px`,\r\n    });\r\n    if (addViewBox) {\r\n        state.svg.setAttribute(\"viewBox\", `0 0 ${state.config.canvasSize.width} ${state.config.canvasSize.height}`);\r\n    }\r\n    container.appendChild(state.svg);\r\n\r\n    state.defs = state.make.defs();\r\n    state.svg.appendChild(state.defs);\r\n\r\n    state.legendGroup = state.make.g();\r\n    state.legendGroup.setAttribute(\"class\", \"legend\");\r\n    state.svg.appendChild(state.legendGroup);\r\n\r\n    state.edgeGroup = state.make.g();\r\n    state.edgeGroup.setAttribute(\"class\", \"edges\");\r\n    state.svg.appendChild(state.edgeGroup);\r\n\r\n    state.nodeGroup = state.make.g();\r\n    state.nodeGroup.setAttribute(\"class\", \"nodes\");\r\n    state.svg.appendChild(state.nodeGroup);\r\n\r\n    state.labelGroup = state.make.g();\r\n    state.labelGroup.setAttribute(\"class\", \"labels\");\r\n    state.svg.appendChild(state.labelGroup);\r\n}\r\n\r\nfunction placeNodes(state: WeathermapRendererState): void {\r\n    for (let node of state.config.weathermapNodes) {\r\n        state.nodeLabelToNode[node.label] = node;\r\n\r\n        let singleNodeGroup: SVGGElement = state.make.g();\r\n        maybeWrapIntoLink(state.make, state.nodeGroup!, singleNodeGroup, state.nodeLinkUriBase, node.linkParams);\r\n\r\n        let rect: SVGRectElement = state.make.rect();\r\n        singleNodeGroup.appendChild(rect);\r\n\r\n        setRectangleDimensions(rect, node.x, node.y, node.width, node.height);\r\n        modifyStyle(rect, {\r\n            \"stroke\": \"gray\",\r\n            \"stroke-width\": \"1px\",\r\n        });\r\n\r\n        let text: SVGTextElement = state.make.text();\r\n        singleNodeGroup.appendChild(text);\r\n\r\n        text.setAttribute(\"x\", `${(+node.x) + (+state.config.textOffsets.left)}`);\r\n        text.setAttribute(\"y\", `${(+node.y) + (+node.height) - state.config.textOffsets.bottom}`);\r\n        if (state.config.showNumbers && node.metricName != null) {\r\n            let value: string = (node.metricName in state.currentValues)\r\n                ? `${state.currentValues[node.metricName]}`\r\n                : \"?\"\r\n            ;\r\n            text.textContent = `${node.label} (${value})`;\r\n        } else {\r\n            text.textContent = node.label;\r\n        }\r\n\r\n        let currentValue: number|null = null;\r\n        if (!node.metricName) {\r\n            modifyStyle(rect, {\r\n                \"fill\": \"silver\",\r\n                \"stroke-dasharray\": state.config.unmeasuredDashArray,\r\n            });\r\n        } else if (node.metricName in state.currentValues) {\r\n            // color node by metric\r\n            currentValue = state.currentValues[node.metricName];\r\n            modifyStyle(rect, {\r\n                \"fill\": gradientColorForValue(state.sortedGradient, \"fillColor\", currentValue),\r\n            });\r\n        } else {\r\n            // no data\r\n            modifyStyle(text, {\r\n                \"fill\": \"white\",\r\n            });\r\n            modifyStyle(rect, {\r\n                \"fill\": \"black\",\r\n                \"stroke-dasharray\": state.config.noValueDashArray,\r\n            });\r\n        }\r\n\r\n        if (currentValue !== null) {\r\n            let titleElem: SVGTitleElement = state.make.title();\r\n            singleNodeGroup.insertBefore(titleElem, titleElem.firstChild);\r\n            titleElem.textContent = `${node.label} (${currentValue.toFixed(2)})`;\r\n        }\r\n    }\r\n}\r\n\r\nfunction placeEdges(state: WeathermapRendererState): void {\r\n    // place edges\r\n    for (let edge of state.config.weathermapEdges) {\r\n        let node1: WeathermapNode = state.nodeLabelToNode[edge.node1];\r\n        let node2: WeathermapNode = state.nodeLabelToNode[edge.node2];\r\n        if (!node1 || !node2) {\r\n            // TODO: output error\r\n            continue;\r\n        }\r\n\r\n        let singleEdgeGroup: SVGGElement = state.make.g();\r\n        maybeWrapIntoLink(state.make, state.edgeGroup!, singleEdgeGroup, state.edgeLinkUriBase, edge.linkParams);\r\n\r\n        let n1Center: Point2D = {\r\n            x: (+node1.x) + ((+node1.width) / 2),\r\n            y: (+node1.y) + ((+node1.height) / 2)\r\n        };\r\n        let n2Center: Point2D = {\r\n            x: (+node2.x) + ((+node2.width) / 2),\r\n            y: (+node2.y) + ((+node2.height) / 2)\r\n        };\r\n\r\n        // calculate bend (control points)\r\n        let control1: Point2D|null = null;\r\n        let control2: Point2D|null = null;\r\n        if (edge.bendDirection && edge.bendMagnitude) {\r\n            // warning: screen coordinates (flipped Y axis)!\r\n            let n1N2Angle: number = Math.atan2(n1Center.y - n2Center.y, n2Center.x - n1Center.x);\r\n            let n2N1Angle: number = Math.atan2(n2Center.y - n1Center.y, n1Center.x - n2Center.x);\r\n\r\n            let n1N2BendAngle: number = normalizeAngle(n1N2Angle + deg2rad(edge.bendDirection));\r\n            let n2N1BendAngle: number = normalizeAngle(n2N1Angle - deg2rad(edge.bendDirection));\r\n\r\n            let control1Offset: Point2D = polarToCartesian(n1N2BendAngle, edge.bendMagnitude);\r\n            let control2Offset: Point2D = polarToCartesian(n2N1BendAngle, edge.bendMagnitude);\r\n\r\n            control1 = {\r\n                x: (+n1Center.x) + control1Offset.x,\r\n                y: (+n1Center.y) - control1Offset.y\r\n            };\r\n            control2 = {\r\n                x: (+n2Center.x) + control2Offset.x,\r\n                y: (+n2Center.y) - control2Offset.y\r\n            };\r\n        }\r\n\r\n        if (edge.metric2Name) {\r\n            // two metrics are twice the fun\r\n            let\r\n                [, point1COut, point2CIn, point2, point2COut, point3CIn,]\r\n            =\r\n                halveCubicBezier(n1Center, control1, control2, n2Center)\r\n            ;\r\n\r\n            makeAndPlaceEdge(\r\n                state, singleEdgeGroup,\r\n                n1Center, point1COut, point2CIn, point2,\r\n                edge.metricName, edge.styleName,\r\n                `${edge.node1} \\u2192 ${edge.node2}`\r\n            );\r\n\r\n            makeAndPlaceEdge(\r\n                state, singleEdgeGroup,\r\n                point2, point2COut, point3CIn, n2Center,\r\n                edge.metric2Name, edge.styleName,\r\n                `${edge.node2} \\u2192 ${edge.node1}`\r\n            );\r\n        } else {\r\n            makeAndPlaceEdge(\r\n                state, singleEdgeGroup,\r\n                n1Center, control1, control2, n2Center,\r\n                edge.metricName, edge.styleName,\r\n                `${edge.node1} \\u2194 ${edge.node2}`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nfunction placeLabels(state: WeathermapRendererState): void {\r\n    for (let label of state.config.weathermapLabels) {\r\n        let singleLabelGroup: SVGGElement = state.make.g();\r\n        state.labelGroup!.appendChild(singleLabelGroup);\r\n\r\n        let text: SVGTextElement = state.make.text();\r\n        singleLabelGroup.appendChild(text);\r\n\r\n        text.setAttribute(\"x\", `${+label.x}`);\r\n        text.setAttribute(\"y\", `${+label.y}`);\r\n        text.textContent = label.label;\r\n    }\r\n}\r\n\r\nfunction makeAndPlaceEdge(\r\n    state: WeathermapRendererState, singleEdgeGroup: SVGGElement, start: Point2D, control1: Point2D|null,\r\n    control2: Point2D|null, end: Point2D, metricName: string|null|undefined, edgeStyleName: string|null|undefined,\r\n    title: string|null|undefined\r\n): void {\r\n    let strokeWidths: number[] = [state.config.strokeWidth];\r\n    let edgeStyle: WeathermapStyle|null = getWeathermapStyle(state, edgeStyleName);\r\n    if (edgeStyle && edgeStyle.strokeWidthArray) {\r\n        let pieces: string[] = edgeStyle.strokeWidthArray.split(/[ ,]+/);\r\n        strokeWidths = pieces.map(p => Number.parseFloat(p));\r\n    }\r\n\r\n    if (strokeWidths.length % 2 !== 1) {\r\n        // like stroke-dasharray, double the elements\r\n        strokeWidths.push(...strokeWidths);\r\n    }\r\n\r\n    let offsetUnitVector: Point2D = {x: 0, y: 0};\r\n    if (strokeWidths.length > 1) {\r\n        // calculate an actual offset vector\r\n\r\n        // get the direction\r\n        let direction: Point2D = {\r\n            x: start.x - end.x,\r\n            y: start.y - end.y\r\n        };\r\n\r\n        // rotate 90°; that's the offset vector\r\n        let offsetVector: Point2D = {\r\n            x: direction.y,\r\n            y: -direction.x\r\n        };\r\n\r\n        // calculate unit vector\r\n        offsetUnitVector = unitVector(offsetVector);\r\n    }\r\n\r\n    let multistrokeGroup: SVGGElement = state.make.g();\r\n    singleEdgeGroup.appendChild(multistrokeGroup);\r\n    modifyStyle(multistrokeGroup, {\r\n        \"fill\": \"none\",\r\n    });\r\n\r\n    let currentValue: number|null = null;\r\n    if (metricName != null && metricName in state.currentValues) {\r\n        currentValue = state.currentValues[metricName];\r\n        modifyStyle(multistrokeGroup, {\r\n            \"stroke\": gradientColorForValue(state.sortedGradient, \"strokeColor\", currentValue)\r\n        });\r\n        modifyApplyingWeathermapStyle(state, multistrokeGroup, edgeStyle);\r\n    } else {\r\n        modifyStyle(multistrokeGroup, {\r\n            \"stroke\": \"black\",\r\n            \"stroke-dasharray\": state.config.noValueDashArray\r\n        });\r\n    }\r\n\r\n    if (title) {\r\n        let titleElem: SVGTitleElement = state.make.title();\r\n        multistrokeGroup.appendChild(titleElem);\r\n        titleElem.textContent = (currentValue === null)\r\n            ? title\r\n            : `${title} (${currentValue.toFixed(2)})`\r\n        ;\r\n    }\r\n\r\n    let totalStrokeWidth: number = strokeWidths.reduce((acc, cur) => acc + cur, 0);\r\n    let currentOffset: number = -totalStrokeWidth/2.0;\r\n    let isSpacing: boolean = true;\r\n    for (let strokeWidth of strokeWidths) {\r\n        isSpacing = !isSpacing;\r\n        if (isSpacing) {\r\n            currentOffset += strokeWidth;\r\n            continue;\r\n        }\r\n\r\n        // calculate offset\r\n        let xOffset: number = offsetUnitVector.x * (currentOffset + strokeWidth/2.0);\r\n        let yOffset: number = offsetUnitVector.y * (currentOffset + strokeWidth/2.0);\r\n\r\n        let strokeStart: Point2D = {\r\n            x: start.x + xOffset,\r\n            y: start.y + yOffset,\r\n        };\r\n        let strokeControl1: Point2D|null = (control1 == null) ? null : {\r\n            x: control1.x + xOffset,\r\n            y: control1.y + yOffset,\r\n        };\r\n        let strokeControl2: Point2D|null = (control2 == null) ? null : {\r\n            x: control2.x + xOffset,\r\n            y: control2.y + yOffset,\r\n        };\r\n        let strokeEnd: Point2D = {\r\n            x: end.x + xOffset,\r\n            y: end.y + yOffset,\r\n        };\r\n\r\n        // make the path\r\n        let path: SVGPathElement = state.make.path();\r\n        multistrokeGroup.appendChild(path);\r\n        if (strokeControl1 == null || strokeControl2 == null) {\r\n            path.setAttribute(\"d\",\r\n                `M ${strokeStart.x},${strokeStart.y} ` +\r\n                `L ${strokeEnd.x},${strokeEnd.y}`\r\n            );\r\n        } else {\r\n            path.setAttribute(\"d\",\r\n                `M ${strokeStart.x},${strokeStart.y} ` +\r\n                `C ${strokeControl1.x},${strokeControl1.y},${strokeControl2.x},${strokeControl2.y},${strokeEnd.x},${strokeEnd.y}`\r\n            );\r\n        }\r\n\r\n        // apply the specific stroke width\r\n        modifyStyle(path, {\r\n            \"stroke-width\": `${strokeWidth}`,\r\n        });\r\n\r\n        currentOffset += strokeWidth;\r\n    }\r\n\r\n    if (state.config.showNumbers) {\r\n        let midpoint: Point2D = halveCubicBezier(start, control1, control2, end)[3];\r\n        let valueString: string = (metricName != null && metricName in state.currentValues)\r\n            ? state.currentValues[metricName].toFixed(2)\r\n            : \"?\"\r\n        ;\r\n        let text: SVGTextElement = state.make.text();\r\n        singleEdgeGroup.appendChild(text);\r\n        text.setAttribute(\"x\", `${midpoint.x}`);\r\n        text.setAttribute(\"y\", `${midpoint.y}`);\r\n        text.textContent = valueString;\r\n    }\r\n}\r\n\r\nfunction maybeWrapIntoLink(\r\n    svgMake: SVGElementCreator, upperGroup: SVGGElement, singleObjectGroup: SVGGElement,\r\n    linkUriBase: string|null|undefined, objLinkParams: string|null|undefined\r\n): void {\r\n    if (linkUriBase != null) {\r\n        let objLinkUri: string = linkUriBase;\r\n        if (objLinkParams != null) {\r\n            objLinkUri += (objLinkUri.indexOf(\"?\") === -1)\r\n                ? \"?\"\r\n                : \"&\";\r\n\r\n            objLinkUri += objLinkParams;\r\n        }\r\n\r\n        let aElement: SVGAElement = svgMake.a();\r\n        upperGroup.appendChild(aElement);\r\n        aElement.setAttributeNS(xlinkNamespace, \"href\", objLinkUri);\r\n\r\n        aElement.appendChild(singleObjectGroup);\r\n    } else {\r\n        upperGroup.appendChild(singleObjectGroup);\r\n    }\r\n}\r\n\r\nexport function setRectangleDimensions(\r\n    element: SVGRectElement, x: number|string, y: number|string, width: number|string, height: number|string\r\n): void {\r\n    element.setAttribute(\"x\", `${x}`);\r\n    element.setAttribute(\"y\", `${y}`);\r\n    element.setAttribute(\"width\", `${width}`);\r\n    element.setAttribute(\"height\", `${height}`);\r\n}\r\n\r\nfunction modifyStyle(element: Element, newValues: object): void {\r\n    // parse style\r\n    let assembledStyle: StringMapping<string> = {};\r\n    if (element.hasAttribute(\"style\")) {\r\n        let styleVal: string|null = element.getAttribute(\"style\");\r\n        if (styleVal != null) {\r\n            for (let chunk of styleVal.split(\";\")) {\r\n                let index: number = chunk.indexOf(\":\");\r\n                if (index === -1) {\r\n                    continue;\r\n                }\r\n                let key: string = chunk.substr(0, index);\r\n                let value: string = chunk.substr(index + 1);\r\n                assembledStyle[key] = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    for (let key in newValues) {\r\n        if (newValues.hasOwnProperty(key)) {\r\n            if (newValues[key] === null) {\r\n                delete assembledStyle[key];\r\n            } else {\r\n                assembledStyle[key] = newValues[key];\r\n            }\r\n        }\r\n    }\r\n\r\n    let keyValuePairs: string[] = [];\r\n    for (let key in assembledStyle) {\r\n        if (assembledStyle.hasOwnProperty(key)) {\r\n            keyValuePairs.push(`${key}:${assembledStyle[key]}`);\r\n        }\r\n    }\r\n\r\n    let keyValueString: string = keyValuePairs.join(\";\");\r\n    element.setAttribute(\"style\", keyValueString);\r\n}\r\n\r\nfunction getWeathermapStyle(\r\n    state: WeathermapRendererState, styleName: string|null|undefined\r\n): WeathermapStyle|null {\r\n    if (!styleName) {\r\n        return null;\r\n    }\r\n\r\n    let style: WeathermapStyle|undefined = state.styleMap[styleName];\r\n    if (!style) {\r\n        return null;\r\n    }\r\n    return style;\r\n}\r\n\r\nfunction modifyApplyingWeathermapStyle(\r\n    state: WeathermapRendererState, element: Element, style: WeathermapStyle|null\r\n): void {\r\n    if (!style) {\r\n        return;\r\n    }\r\n\r\n    let styleProps: StringMapping<string> = {};\r\n    if (style.dashArray) {\r\n        styleProps[\"stroke-dasharray\"] = style.dashArray;\r\n    }\r\n    // style.strokeWidthArray is handled beforehand\r\n\r\n    modifyStyle(element, styleProps);\r\n}\r\n\r\n\r\nexport class WeathermapRendererState {\r\n    make: SVGElementCreator;\r\n    config: WeathermapConfig;\r\n    sortedGradient: Gradient;\r\n    currentValues: MetricValueMap;\r\n    nodeLabelToNode: LabelToNodeMap;\r\n    nodeLinkUriBase: string|null;\r\n    edgeLinkUriBase: string|null;\r\n    svg: SVGSVGElement|null;\r\n    defs: SVGDefsElement|null;\r\n    edgeGroup: SVGGElement|null;\r\n    nodeGroup: SVGGElement|null;\r\n    labelGroup: SVGGElement|null;\r\n    legendGroup: SVGGElement|null;\r\n    styleMap: NameToStyleMap;\r\n\r\n    constructor(\r\n        domCreator: SVGElementCreatorDOM, config: WeathermapConfig, sortedGradient: Gradient, currentValues: MetricValueMap\r\n    ) {\r\n        this.make = new SVGElementCreator(domCreator);\r\n        this.config = config;\r\n        this.sortedGradient = sortedGradient;\r\n        this.currentValues = currentValues;\r\n        this.nodeLabelToNode = {};\r\n        this.nodeLinkUriBase = null;\r\n        this.edgeLinkUriBase = null;\r\n        this.svg = null;\r\n        this.defs = null;\r\n        this.edgeGroup = null;\r\n        this.nodeGroup = null;\r\n        this.labelGroup = null;\r\n        this.legendGroup = null;\r\n\r\n        this.styleMap = {};\r\n        if (config.weathermapStyles) {\r\n            for (let style of config.weathermapStyles) {\r\n                this.styleMap[style.name] = style;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class SVGElementCreator {\r\n    maker: SVGElementCreatorDOM;\r\n\r\n    constructor(maker: SVGElementCreatorDOM) { this.maker = maker; }\r\n\r\n    a() { return <SVGAElement>this.maker.createElementNS(svgNamespace, \"a\"); }\r\n    defs() { return <SVGDefsElement>this.maker.createElementNS(svgNamespace, \"defs\"); }\r\n    g() { return <SVGGElement>this.maker.createElementNS(svgNamespace, \"g\"); }\r\n    linearGradient() { return <SVGLinearGradientElement>this.maker.createElementNS(svgNamespace, \"linearGradient\"); }\r\n    path() { return <SVGPathElement>this.maker.createElementNS(svgNamespace, \"path\"); }\r\n    rect() { return <SVGRectElement>this.maker.createElementNS(svgNamespace, \"rect\"); }\r\n    stop() { return <SVGStopElement>this.maker.createElementNS(svgNamespace, \"stop\"); }\r\n    svg() { return <SVGSVGElement>this.maker.createElementNS(svgNamespace, \"svg\"); }\r\n    text() { return <SVGTextElement>this.maker.createElementNS(svgNamespace, \"text\"); }\r\n    title() { return <SVGTitleElement>this.maker.createElementNS(svgNamespace, \"title\"); }\r\n}\r\n\r\nexport interface SVGElementCreatorDOM {\r\n    createElementNS(namespaceURI: string, qualifiedName: string): Element;\r\n}\r\n\r\ninterface PositionableTextElement {\r\n    label: string;\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport interface WeathermapNode extends PositionableTextElement {\r\n    width: number;\r\n    height: number;\r\n    metricName?: string|null;\r\n    linkParams?: string;\r\n}\r\n\r\nexport interface WeathermapEdge {\r\n    node1: string;\r\n    node2: string;\r\n    bendDirection?: number;\r\n    bendMagnitude?: number;\r\n    metricName?: string;\r\n    metric2Name?: string|null;\r\n    linkParams?: string;\r\n    styleName?: string;\r\n}\r\n\r\nexport interface WeathermapLabel extends PositionableTextElement {\r\n}\r\n\r\nexport interface WeathermapStyle {\r\n    name: string;\r\n    strokeWidthArray?: string;\r\n    dashArray?: string;\r\n}\r\n\r\ninterface LinkSettings {\r\n    node: ObjectLinkSettings;\r\n    edge: ObjectLinkSettings;\r\n}\r\n\r\nexport interface StringMapping<V> {\r\n    [key: string]: V;\r\n}\r\n\r\nexport type LabelToNodeMap = StringMapping<WeathermapNode>;\r\nexport type MetricValueMap = StringMapping<number>;\r\nexport type NameToStyleMap = StringMapping<WeathermapStyle>;\r\n\r\nexport interface ObjectLinkSettings {\r\n    type: \"none\"|\"dashboard\"|\"absolute\";\r\n    dashboard: string|null;\r\n    dashUri: string|null;\r\n    absoluteUri: string|null;\r\n}\r\n\r\nexport interface WeathermapDefaultConfig {\r\n    weathermapEdges: WeathermapEdge[];\r\n    weathermapNodes: WeathermapNode[];\r\n    weathermapLabels: WeathermapLabel[];\r\n    weathermapStyles: WeathermapStyle[];\r\n    canvasSize: { width: number; height: number; };\r\n    textOffsets: { left: number; bottom: number; };\r\n    showNumbers: boolean;\r\n    valueName: \"max\"|\"min\"|\"avg\"|\"current\"|\"total\";\r\n    nullPointMode: \"connected\"|\"null\"|\"null as zero\";\r\n    strokeWidth: number;\r\n    gradient: Gradient;\r\n    legend: LegendSettings;\r\n    link: LinkSettings;\r\n    noValueDashArray: string;\r\n    unmeasuredDashArray: string;\r\n}\r\n\r\nexport interface WeathermapConfig extends WeathermapDefaultConfig {\r\n    id: number;\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"http\");","import { MetricValueMap } from \"../svg-weathermap/weathermap\";\r\nimport * as http from \"http\";\r\n\r\nexport async function fetchMetrics(baseUrl: URL, metrics: PrometheusMetric[], lookback_interval: string): Promise<MetricValueMap> {\r\n    // query\r\n    let agent = new http.Agent();\r\n\r\n    let metricValueMap = {};\r\n\r\n    for (let metric of metrics) {\r\n        let metricQueryEscaped: string = encodeURIComponent(\r\n            metric.expr\r\n                .replace(\"$lookback_interval\", lookback_interval)\r\n                .replace(\"$__range\", lookback_interval)\r\n        );\r\n        let metricUrl = new URL(`api/v1/query?query=${metricQueryEscaped}`, baseUrl);\r\n\r\n        let [response, body] = await httpGetAsync(\r\n            metricUrl.protocol, metricUrl.hostname, +metricUrl.port, metricUrl.pathname + metricUrl.search, agent\r\n        );\r\n        let metricData: any = JSON.parse(body);\r\n\r\n        for (let result of metricData.data.result) {\r\n            let labels: any = result.metric;\r\n            let value: number = +result.value[1];\r\n\r\n            let key: string = interpolateLabels(metric.legendFormat, labels);\r\n            metricValueMap[key] = value;\r\n        }\r\n\r\n        response.destroy();\r\n    }\r\n\r\n    agent.destroy();\r\n\r\n    return metricValueMap;\r\n}\r\n\r\nfunction interpolateLabels(template: string, labels: object): string {\r\n    let output: string = template;\r\n    for (;;) {\r\n        let nextBracesIndex: number = output.indexOf(\"{{\");\r\n        if (nextBracesIndex === -1) {\r\n            return output;\r\n        }\r\n\r\n        let endBracesIndex: number = output.indexOf(\"}}\", nextBracesIndex);\r\n        if (endBracesIndex === -1) {\r\n            return output;\r\n        }\r\n\r\n        let variableName: string = output.substr(nextBracesIndex + 2, endBracesIndex - nextBracesIndex - 2);\r\n        let variableValue: string = variableName in labels\r\n            ? labels[variableName]\r\n            : \"\";\r\n\r\n        output = output.substr(0, nextBracesIndex) + variableValue + output.substr(endBracesIndex + 2);\r\n    }\r\n}\r\n\r\nfunction httpGetAsync(\r\n    protocol: string, hostname: string, port: number, path: string, agent: http.Agent\r\n): Promise<[http.IncomingMessage, string]> {\r\n    return new Promise<[http.IncomingMessage, string]>((resolve, reject) => {\r\n        let options: object = {\r\n            protocol: protocol,\r\n            hostname: hostname,\r\n            port: port,\r\n            path: path,\r\n            agent: agent\r\n        };\r\n        let req: http.ClientRequest = http.request(options, res => {\r\n            let body: string = \"\";\r\n            res.on(\"data\", chunk => {\r\n                body += chunk;\r\n            });\r\n            res.on(\"end\", () => {\r\n                resolve([res, body]);\r\n            });\r\n        });\r\n        req.on(\"error\", err => {\r\n            reject(err);\r\n        });\r\n        req.end();\r\n    });\r\n}\r\n\r\nexport interface PrometheusMetric {\r\n    expr: string;\r\n    legendFormat: string;\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"fs\");","import { svgNamespace } from \"../svg-weathermap/constants\";\r\nimport { WeathermapConfig, renderWeathermapInto } from \"../svg-weathermap/weathermap\";\r\nimport { DOMImplementation, XMLSerializer } from \"@xmldom/xmldom\";\r\nimport { PrometheusMetric, fetchMetrics } from \"./fetcher\";\r\nimport * as fs from \"fs\";\r\n\r\nlet options = {\r\n    configFile: \"genwmap.json\",\r\n    outputFile: \"weathermap.svg\"\r\n};\r\n\r\nfunction printUsage(): void {\r\n    console.error(\"Usage: genwmap [-c CONFIG.json] [-o OUTPUT.svg]\");\r\n}\r\n\r\nfunction processOptions(): boolean {\r\n    let awaiting: string|null = null;\r\n\r\n    for (let i: number = 2; i < process.argv.length; ++i) {\r\n        let arg: string = process.argv[i];\r\n\r\n        if (awaiting === null) {\r\n            if (arg === \"-c\" || arg === \"-o\") {\r\n                awaiting = arg;\r\n            } else {\r\n                console.error(`Unknown option '${arg}'`);\r\n                printUsage();\r\n                return false;\r\n            }\r\n        } else {\r\n            if (awaiting === \"-c\") {\r\n                options.configFile = arg;\r\n            } else if (awaiting === \"-o\") {\r\n                options.outputFile = arg;\r\n            }\r\n            awaiting = null;\r\n        }\r\n    }\r\n\r\n    if (awaiting !== null) {\r\n        console.error(`No value specified for option '${awaiting}'`);\r\n        printUsage();\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport async function main(): Promise<void> {\r\n    if (!processOptions()) {\r\n        process.exitCode = 1;\r\n        return;\r\n    }\r\n\r\n    let configString: string = await readFileAsync(options.configFile);\r\n    let config: any = JSON.parse(configString);\r\n\r\n    let weathermap: WeathermapConfig = config.weathermap;\r\n    let metrics: PrometheusMetric[] = config.weathermap.targets;\r\n    let dataSources: { [index: string]: string; } = config.dataSources;\r\n    let lookbackInterval: string = config.lookbackInterval;\r\n    let styleDefinition: string|null = config.styleDefinition;\r\n\r\n    let dataSource = config.weathermap.datasource;\r\n    if (dataSource !== null && typeof dataSource === 'object' && !Array.isArray(dataSource)) {\r\n        // newer versions of Grafana store data source as {\"type\":\"prometheus\", \"uid\":\"00000001\"}\r\n        // take the UID as it is probably unique\r\n        dataSource = dataSource.uid;\r\n    }\r\n    let metricValues: any = await fetchMetrics(new URL(dataSources[dataSource]), metrics, lookbackInterval);\r\n    let impl = new DOMImplementation();\r\n    let doc: Document = impl.createDocument(null, null, null);\r\n\r\n    const nullLinkResolver: null = null;\r\n    const addViewBox: boolean = true;\r\n    let svg: SVGSVGElement = renderWeathermapInto(doc, doc, weathermap, metricValues, nullLinkResolver, addViewBox);\r\n    if (styleDefinition) {\r\n        let svgStyle = <SVGStyleElement><unknown>doc.createElementNS(svgNamespace, \"style\");\r\n        svg.insertBefore(svgStyle, svg.firstElementChild);\r\n        svgStyle.setAttribute(\"type\", \"text/css\");\r\n        svgStyle.textContent = styleDefinition;\r\n    }\r\n\r\n    let outputter = new XMLSerializer();\r\n    let outputString: string = outputter.serializeToString(doc);\r\n    await writeFileAsync(options.outputFile, outputString, {});\r\n}\r\n\r\nfunction readFileAsync(path: string): Promise<string> {\r\n    return new Promise<string>((resolve, reject) => {\r\n        fs.readFile(path, { encoding: \"utf8\" }, (err, data) => {\r\n            if (err) {\r\n                reject(err);\r\n            } else {\r\n                resolve(data);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction writeFileAsync(path: string, data: string, options: {}): Promise<void> {\r\n    return new Promise<void>((resolve, reject) => {\r\n        fs.writeFile(path, data, options, err => {\r\n            if (err) {\r\n                reject(err);\r\n            } else {\r\n                resolve();\r\n            }\r\n        });\r\n    });\r\n}\r\n","'use strict'\n\n/**\n * \"Shallow freezes\" an object to render it immutable.\n * Uses `Object.freeze` if available,\n * otherwise the immutability is only in the type.\n *\n * Is used to create \"enum like\" objects.\n *\n * @template T\n * @param {T} object the object to freeze\n * @param {Pick<ObjectConstructor, 'freeze'> = Object} oc `Object` by default,\n * \t\t\t\tallows to inject custom object constructor for tests\n * @returns {Readonly<T>}\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n */\nfunction freeze(object, oc) {\n\tif (oc === undefined) {\n\t\toc = Object\n\t}\n\treturn oc && typeof oc.freeze === 'function' ? oc.freeze(object) : object\n}\n\n/**\n * Since we can not rely on `Object.assign` we provide a simplified version\n * that is sufficient for our needs.\n *\n * @param {Object} target\n * @param {Object | null | undefined} source\n *\n * @returns {Object} target\n * @throws TypeError if target is not an object\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n * @see https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object.assign\n */\nfunction assign(target, source) {\n\tif (target === null || typeof target !== 'object') {\n\t\tthrow new TypeError('target is not an object')\n\t}\n\tfor (var key in source) {\n\t\tif (Object.prototype.hasOwnProperty.call(source, key)) {\n\t\t\ttarget[key] = source[key]\n\t\t}\n\t}\n\treturn target\n}\n\n/**\n * All mime types that are allowed as input to `DOMParser.parseFromString`\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString#Argument02 MDN\n * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#domparsersupportedtype WHATWG HTML Spec\n * @see DOMParser.prototype.parseFromString\n */\nvar MIME_TYPE = freeze({\n\t/**\n\t * `text/html`, the only mime type that triggers treating an XML document as HTML.\n\t *\n\t * @see DOMParser.SupportedType.isHTML\n\t * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration\n\t * @see https://en.wikipedia.org/wiki/HTML Wikipedia\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN\n\t * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring WHATWG HTML Spec\n\t */\n\tHTML: 'text/html',\n\n\t/**\n\t * Helper method to check a mime type if it indicates an HTML document\n\t *\n\t * @param {string} [value]\n\t * @returns {boolean}\n\t *\n\t * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration\n\t * @see https://en.wikipedia.org/wiki/HTML Wikipedia\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN\n\t * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring \t */\n\tisHTML: function (value) {\n\t\treturn value === MIME_TYPE.HTML\n\t},\n\n\t/**\n\t * `application/xml`, the standard mime type for XML documents.\n\t *\n\t * @see https://www.iana.org/assignments/media-types/application/xml IANA MimeType registration\n\t * @see https://tools.ietf.org/html/rfc7303#section-9.1 RFC 7303\n\t * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia\n\t */\n\tXML_APPLICATION: 'application/xml',\n\n\t/**\n\t * `text/html`, an alias for `application/xml`.\n\t *\n\t * @see https://tools.ietf.org/html/rfc7303#section-9.2 RFC 7303\n\t * @see https://www.iana.org/assignments/media-types/text/xml IANA MimeType registration\n\t * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia\n\t */\n\tXML_TEXT: 'text/xml',\n\n\t/**\n\t * `application/xhtml+xml`, indicates an XML document that has the default HTML namespace,\n\t * but is parsed as an XML document.\n\t *\n\t * @see https://www.iana.org/assignments/media-types/application/xhtml+xml IANA MimeType registration\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument WHATWG DOM Spec\n\t * @see https://en.wikipedia.org/wiki/XHTML Wikipedia\n\t */\n\tXML_XHTML_APPLICATION: 'application/xhtml+xml',\n\n\t/**\n\t * `image/svg+xml`,\n\t *\n\t * @see https://www.iana.org/assignments/media-types/image/svg+xml IANA MimeType registration\n\t * @see https://www.w3.org/TR/SVG11/ W3C SVG 1.1\n\t * @see https://en.wikipedia.org/wiki/Scalable_Vector_Graphics Wikipedia\n\t */\n\tXML_SVG_IMAGE: 'image/svg+xml',\n})\n\n/**\n * Namespaces that are used in this code base.\n *\n * @see http://www.w3.org/TR/REC-xml-names\n */\nvar NAMESPACE = freeze({\n\t/**\n\t * The XHTML namespace.\n\t *\n\t * @see http://www.w3.org/1999/xhtml\n\t */\n\tHTML: 'http://www.w3.org/1999/xhtml',\n\n\t/**\n\t * Checks if `uri` equals `NAMESPACE.HTML`.\n\t *\n\t * @param {string} [uri]\n\t *\n\t * @see NAMESPACE.HTML\n\t */\n\tisHTML: function (uri) {\n\t\treturn uri === NAMESPACE.HTML\n\t},\n\n\t/**\n\t * The SVG namespace.\n\t *\n\t * @see http://www.w3.org/2000/svg\n\t */\n\tSVG: 'http://www.w3.org/2000/svg',\n\n\t/**\n\t * The `xml:` namespace.\n\t *\n\t * @see http://www.w3.org/XML/1998/namespace\n\t */\n\tXML: 'http://www.w3.org/XML/1998/namespace',\n\n\t/**\n\t * The `xmlns:` namespace\n\t *\n\t * @see https://www.w3.org/2000/xmlns/\n\t */\n\tXMLNS: 'http://www.w3.org/2000/xmlns/',\n})\n\nexports.assign = assign;\nexports.freeze = freeze;\nexports.MIME_TYPE = MIME_TYPE;\nexports.NAMESPACE = NAMESPACE;\n","var conventions = require(\"./conventions\");\nvar dom = require('./dom')\nvar entities = require('./entities');\nvar sax = require('./sax');\n\nvar DOMImplementation = dom.DOMImplementation;\n\nvar NAMESPACE = conventions.NAMESPACE;\n\nvar ParseError = sax.ParseError;\nvar XMLReader = sax.XMLReader;\n\n/**\n * Normalizes line ending according to https://www.w3.org/TR/xml11/#sec-line-ends:\n *\n * > XML parsed entities are often stored in computer files which,\n * > for editing convenience, are organized into lines.\n * > These lines are typically separated by some combination\n * > of the characters CARRIAGE RETURN (#xD) and LINE FEED (#xA).\n * >\n * > To simplify the tasks of applications, the XML processor must behave\n * > as if it normalized all line breaks in external parsed entities (including the document entity)\n * > on input, before parsing, by translating all of the following to a single #xA character:\n * >\n * > 1. the two-character sequence #xD #xA\n * > 2. the two-character sequence #xD #x85\n * > 3. the single character #x85\n * > 4. the single character #x2028\n * > 5. any #xD character that is not immediately followed by #xA or #x85.\n *\n * @param {string} input\n * @returns {string}\n */\nfunction normalizeLineEndings(input) {\n\treturn input\n\t\t.replace(/\\r[\\n\\u0085]/g, '\\n')\n\t\t.replace(/[\\r\\u0085\\u2028]/g, '\\n')\n}\n\n/**\n * @typedef Locator\n * @property {number} [columnNumber]\n * @property {number} [lineNumber]\n */\n\n/**\n * @typedef DOMParserOptions\n * @property {DOMHandler} [domBuilder]\n * @property {Function} [errorHandler]\n * @property {(string) => string} [normalizeLineEndings] used to replace line endings before parsing\n * \t\t\t\t\t\tdefaults to `normalizeLineEndings`\n * @property {Locator} [locator]\n * @property {Record<string, string>} [xmlns]\n *\n * @see normalizeLineEndings\n */\n\n/**\n * The DOMParser interface provides the ability to parse XML or HTML source code\n * from a string into a DOM `Document`.\n *\n * _xmldom is different from the spec in that it allows an `options` parameter,\n * to override the default behavior._\n *\n * @param {DOMParserOptions} [options]\n * @constructor\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser\n * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsing-and-serialization\n */\nfunction DOMParser(options){\n\tthis.options = options ||{locator:{}};\n}\n\nDOMParser.prototype.parseFromString = function(source,mimeType){\n\tvar options = this.options;\n\tvar sax =  new XMLReader();\n\tvar domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler\n\tvar errorHandler = options.errorHandler;\n\tvar locator = options.locator;\n\tvar defaultNSMap = options.xmlns||{};\n\tvar isHTML = /\\/x?html?$/.test(mimeType);//mimeType.toLowerCase().indexOf('html') > -1;\n  \tvar entityMap = isHTML ? entities.HTML_ENTITIES : entities.XML_ENTITIES;\n\tif(locator){\n\t\tdomBuilder.setDocumentLocator(locator)\n\t}\n\n\tsax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);\n\tsax.domBuilder = options.domBuilder || domBuilder;\n\tif(isHTML){\n\t\tdefaultNSMap[''] = NAMESPACE.HTML;\n\t}\n\tdefaultNSMap.xml = defaultNSMap.xml || NAMESPACE.XML;\n\tvar normalize = options.normalizeLineEndings || normalizeLineEndings;\n\tif (source && typeof source === 'string') {\n\t\tsax.parse(\n\t\t\tnormalize(source),\n\t\t\tdefaultNSMap,\n\t\t\tentityMap\n\t\t)\n\t} else {\n\t\tsax.errorHandler.error('invalid doc source')\n\t}\n\treturn domBuilder.doc;\n}\nfunction buildErrorHandler(errorImpl,domBuilder,locator){\n\tif(!errorImpl){\n\t\tif(domBuilder instanceof DOMHandler){\n\t\t\treturn domBuilder;\n\t\t}\n\t\terrorImpl = domBuilder ;\n\t}\n\tvar errorHandler = {}\n\tvar isCallback = errorImpl instanceof Function;\n\tlocator = locator||{}\n\tfunction build(key){\n\t\tvar fn = errorImpl[key];\n\t\tif(!fn && isCallback){\n\t\t\tfn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;\n\t\t}\n\t\terrorHandler[key] = fn && function(msg){\n\t\t\tfn('[xmldom '+key+']\\t'+msg+_locator(locator));\n\t\t}||function(){};\n\t}\n\tbuild('warning');\n\tbuild('error');\n\tbuild('fatalError');\n\treturn errorHandler;\n}\n\n//console.log('#\\n\\n\\n\\n\\n\\n\\n####')\n/**\n * +ContentHandler+ErrorHandler\n * +LexicalHandler+EntityResolver2\n * -DeclHandler-DTDHandler\n *\n * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler\n * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2\n * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html\n */\nfunction DOMHandler() {\n    this.cdata = false;\n}\nfunction position(locator,node){\n\tnode.lineNumber = locator.lineNumber;\n\tnode.columnNumber = locator.columnNumber;\n}\n/**\n * @see org.xml.sax.ContentHandler#startDocument\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html\n */\nDOMHandler.prototype = {\n\tstartDocument : function() {\n    \tthis.doc = new DOMImplementation().createDocument(null, null, null);\n    \tif (this.locator) {\n        \tthis.doc.documentURI = this.locator.systemId;\n    \t}\n\t},\n\tstartElement:function(namespaceURI, localName, qName, attrs) {\n\t\tvar doc = this.doc;\n\t    var el = doc.createElementNS(namespaceURI, qName||localName);\n\t    var len = attrs.length;\n\t    appendElement(this, el);\n\t    this.currentElement = el;\n\n\t\tthis.locator && position(this.locator,el)\n\t    for (var i = 0 ; i < len; i++) {\n\t        var namespaceURI = attrs.getURI(i);\n\t        var value = attrs.getValue(i);\n\t        var qName = attrs.getQName(i);\n\t\t\tvar attr = doc.createAttributeNS(namespaceURI, qName);\n\t\t\tthis.locator &&position(attrs.getLocator(i),attr);\n\t\t\tattr.value = attr.nodeValue = value;\n\t\t\tel.setAttributeNode(attr)\n\t    }\n\t},\n\tendElement:function(namespaceURI, localName, qName) {\n\t\tvar current = this.currentElement\n\t\tvar tagName = current.tagName;\n\t\tthis.currentElement = current.parentNode;\n\t},\n\tstartPrefixMapping:function(prefix, uri) {\n\t},\n\tendPrefixMapping:function(prefix) {\n\t},\n\tprocessingInstruction:function(target, data) {\n\t    var ins = this.doc.createProcessingInstruction(target, data);\n\t    this.locator && position(this.locator,ins)\n\t    appendElement(this, ins);\n\t},\n\tignorableWhitespace:function(ch, start, length) {\n\t},\n\tcharacters:function(chars, start, length) {\n\t\tchars = _toString.apply(this,arguments)\n\t\t//console.log(chars)\n\t\tif(chars){\n\t\t\tif (this.cdata) {\n\t\t\t\tvar charNode = this.doc.createCDATASection(chars);\n\t\t\t} else {\n\t\t\t\tvar charNode = this.doc.createTextNode(chars);\n\t\t\t}\n\t\t\tif(this.currentElement){\n\t\t\t\tthis.currentElement.appendChild(charNode);\n\t\t\t}else if(/^\\s*$/.test(chars)){\n\t\t\t\tthis.doc.appendChild(charNode);\n\t\t\t\t//process xml\n\t\t\t}\n\t\t\tthis.locator && position(this.locator,charNode)\n\t\t}\n\t},\n\tskippedEntity:function(name) {\n\t},\n\tendDocument:function() {\n\t\tthis.doc.normalize();\n\t},\n\tsetDocumentLocator:function (locator) {\n\t    if(this.locator = locator){// && !('lineNumber' in locator)){\n\t    \tlocator.lineNumber = 0;\n\t    }\n\t},\n\t//LexicalHandler\n\tcomment:function(chars, start, length) {\n\t\tchars = _toString.apply(this,arguments)\n\t    var comm = this.doc.createComment(chars);\n\t    this.locator && position(this.locator,comm)\n\t    appendElement(this, comm);\n\t},\n\n\tstartCDATA:function() {\n\t    //used in characters() methods\n\t    this.cdata = true;\n\t},\n\tendCDATA:function() {\n\t    this.cdata = false;\n\t},\n\n\tstartDTD:function(name, publicId, systemId) {\n\t\tvar impl = this.doc.implementation;\n\t    if (impl && impl.createDocumentType) {\n\t        var dt = impl.createDocumentType(name, publicId, systemId);\n\t        this.locator && position(this.locator,dt)\n\t        appendElement(this, dt);\n\t\t\t\t\tthis.doc.doctype = dt;\n\t    }\n\t},\n\t/**\n\t * @see org.xml.sax.ErrorHandler\n\t * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html\n\t */\n\twarning:function(error) {\n\t\tconsole.warn('[xmldom warning]\\t'+error,_locator(this.locator));\n\t},\n\terror:function(error) {\n\t\tconsole.error('[xmldom error]\\t'+error,_locator(this.locator));\n\t},\n\tfatalError:function(error) {\n\t\tthrow new ParseError(error, this.locator);\n\t}\n}\nfunction _locator(l){\n\tif(l){\n\t\treturn '\\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'\n\t}\n}\nfunction _toString(chars,start,length){\n\tif(typeof chars == 'string'){\n\t\treturn chars.substr(start,length)\n\t}else{//java sax connect width xmldom on rhino(what about: \"? && !(chars instanceof String)\")\n\t\tif(chars.length >= start+length || start){\n\t\t\treturn new java.lang.String(chars,start,length)+'';\n\t\t}\n\t\treturn chars;\n\t}\n}\n\n/*\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html\n * used method of org.xml.sax.ext.LexicalHandler:\n *  #comment(chars, start, length)\n *  #startCDATA()\n *  #endCDATA()\n *  #startDTD(name, publicId, systemId)\n *\n *\n * IGNORED method of org.xml.sax.ext.LexicalHandler:\n *  #endDTD()\n *  #startEntity(name)\n *  #endEntity(name)\n *\n *\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html\n * IGNORED method of org.xml.sax.ext.DeclHandler\n * \t#attributeDecl(eName, aName, type, mode, value)\n *  #elementDecl(name, model)\n *  #externalEntityDecl(name, publicId, systemId)\n *  #internalEntityDecl(name, value)\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html\n * IGNORED method of org.xml.sax.EntityResolver2\n *  #resolveEntity(String name,String publicId,String baseURI,String systemId)\n *  #resolveEntity(publicId, systemId)\n *  #getExternalSubset(name, baseURI)\n * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html\n * IGNORED method of org.xml.sax.DTDHandler\n *  #notationDecl(name, publicId, systemId) {};\n *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};\n */\n\"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl\".replace(/\\w+/g,function(key){\n\tDOMHandler.prototype[key] = function(){return null}\n})\n\n/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */\nfunction appendElement (hander,node) {\n    if (!hander.currentElement) {\n        hander.doc.appendChild(node);\n    } else {\n        hander.currentElement.appendChild(node);\n    }\n}//appendChild and setAttributeNS are preformance key\n\nexports.__DOMHandler = DOMHandler;\nexports.normalizeLineEndings = normalizeLineEndings;\nexports.DOMParser = DOMParser;\n","var conventions = require(\"./conventions\");\n\nvar NAMESPACE = conventions.NAMESPACE;\n\n/**\n * A prerequisite for `[].filter`, to drop elements that are empty\n * @param {string} input\n * @returns {boolean}\n */\nfunction notEmptyString (input) {\n\treturn input !== ''\n}\n/**\n * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace\n * @see https://infra.spec.whatwg.org/#ascii-whitespace\n *\n * @param {string} input\n * @returns {string[]} (can be empty)\n */\nfunction splitOnASCIIWhitespace(input) {\n\t// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE\n\treturn input ? input.split(/[\\t\\n\\f\\r ]+/).filter(notEmptyString) : []\n}\n\n/**\n * Adds element as a key to current if it is not already present.\n *\n * @param {Record<string, boolean | undefined>} current\n * @param {string} element\n * @returns {Record<string, boolean | undefined>}\n */\nfunction orderedSetReducer (current, element) {\n\tif (!current.hasOwnProperty(element)) {\n\t\tcurrent[element] = true;\n\t}\n\treturn current;\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#ordered-set\n * @param {string} input\n * @returns {string[]}\n */\nfunction toOrderedSet(input) {\n\tif (!input) return [];\n\tvar list = splitOnASCIIWhitespace(input);\n\treturn Object.keys(list.reduce(orderedSetReducer, {}))\n}\n\n/**\n * Uses `list.indexOf` to implement something like `Array.prototype.includes`,\n * which we can not rely on being available.\n *\n * @param {any[]} list\n * @returns {function(any): boolean}\n */\nfunction arrayIncludes (list) {\n\treturn function(element) {\n\t\treturn list && list.indexOf(element) !== -1;\n\t}\n}\n\nfunction copy(src,dest){\n\tfor(var p in src){\n\t\tdest[p] = src[p];\n\t}\n}\n\n/**\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\n */\nfunction _extends(Class,Super){\n\tvar pt = Class.prototype;\n\tif(!(pt instanceof Super)){\n\t\tfunction t(){};\n\t\tt.prototype = Super.prototype;\n\t\tt = new t();\n\t\tcopy(pt,t);\n\t\tClass.prototype = pt = t;\n\t}\n\tif(pt.constructor != Class){\n\t\tif(typeof Class != 'function'){\n\t\t\tconsole.error(\"unknown Class:\"+Class)\n\t\t}\n\t\tpt.constructor = Class\n\t}\n}\n\n// Node Types\nvar NodeType = {}\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\n\n// ExceptionCode\nvar ExceptionCode = {}\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\n//level2\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\n\n/**\n * DOM Level 2\n * Object DOMException\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\n */\nfunction DOMException(code, message) {\n\tif(message instanceof Error){\n\t\tvar error = message;\n\t}else{\n\t\terror = this;\n\t\tError.call(this, ExceptionMessage[code]);\n\t\tthis.message = ExceptionMessage[code];\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n\t}\n\terror.code = code;\n\tif(message) this.message = this.message + \": \" + message;\n\treturn error;\n};\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode,DOMException)\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\n * The items in the NodeList are accessible via an integral index, starting from 0.\n */\nfunction NodeList() {\n};\nNodeList.prototype = {\n\t/**\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\n\t * @standard level1\n\t */\n\tlength:0, \n\t/**\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\n\t * @standard level1\n\t * @param index  unsigned long \n\t *   Index into the collection.\n\t * @return Node\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \n\t */\n\titem: function(index) {\n\t\treturn this[index] || null;\n\t},\n\ttoString:function(isHTML,nodeFilter){\n\t\tfor(var buf = [], i = 0;i<this.length;i++){\n\t\t\tserializeToString(this[i],buf,isHTML,nodeFilter);\n\t\t}\n\t\treturn buf.join('');\n\t}\n};\n\nfunction LiveNodeList(node,refresh){\n\tthis._node = node;\n\tthis._refresh = refresh\n\t_updateLiveList(this);\n}\nfunction _updateLiveList(list){\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\n\tif(list._inc != inc){\n\t\tvar ls = list._refresh(list._node);\n\t\t//console.log(ls.length)\n\t\t__set__(list,'length',ls.length);\n\t\tcopy(ls,list);\n\t\tlist._inc = inc;\n\t}\n}\nLiveNodeList.prototype.item = function(i){\n\t_updateLiveList(this);\n\treturn this[i];\n}\n\n_extends(LiveNodeList,NodeList);\n\n/**\n * Objects implementing the NamedNodeMap interface are used\n * to represent collections of nodes that can be accessed by name.\n * Note that NamedNodeMap does not inherit from NodeList;\n * NamedNodeMaps are not maintained in any particular order.\n * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,\n * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,\n * and does not imply that the DOM specifies an order to these Nodes.\n * NamedNodeMap objects in the DOM are live.\n * used for attributes or DocumentType entities \n */\nfunction NamedNodeMap() {\n};\n\nfunction _findNodeIndex(list,node){\n\tvar i = list.length;\n\twhile(i--){\n\t\tif(list[i] === node){return i}\n\t}\n}\n\nfunction _addNamedNode(el,list,newAttr,oldAttr){\n\tif(oldAttr){\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\n\t}else{\n\t\tlist[list.length++] = newAttr;\n\t}\n\tif(el){\n\t\tnewAttr.ownerElement = el;\n\t\tvar doc = el.ownerDocument;\n\t\tif(doc){\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\n\t\t\t_onAddAttribute(doc,el,newAttr);\n\t\t}\n\t}\n}\nfunction _removeNamedNode(el,list,attr){\n\t//console.log('remove attr:'+attr)\n\tvar i = _findNodeIndex(list,attr);\n\tif(i>=0){\n\t\tvar lastIndex = list.length-1\n\t\twhile(i<lastIndex){\n\t\t\tlist[i] = list[++i]\n\t\t}\n\t\tlist.length = lastIndex;\n\t\tif(el){\n\t\t\tvar doc = el.ownerDocument;\n\t\t\tif(doc){\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\n\t\t\t\tattr.ownerElement = null;\n\t\t\t}\n\t\t}\n\t}else{\n\t\tthrow DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))\n\t}\n}\nNamedNodeMap.prototype = {\n\tlength:0,\n\titem:NodeList.prototype.item,\n\tgetNamedItem: function(key) {\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n//\t\t\treturn null;\n//\t\t}\n\t\t//console.log()\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar attr = this[i];\n\t\t\t//console.log(attr.nodeName,key)\n\t\t\tif(attr.nodeName == key){\n\t\t\t\treturn attr;\n\t\t\t}\n\t\t}\n\t},\n\tsetNamedItem: function(attr) {\n\t\tvar el = attr.ownerElement;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\t/* returns Node */\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n\t\tvar el = attr.ownerElement, oldAttr;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\n\t/* returns Node */\n\tremoveNamedItem: function(key) {\n\t\tvar attr = this.getNamedItem(key);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t\t\n\t\t\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n\t\n\t//for level2\n\tremoveNamedItemNS:function(namespaceURI,localName){\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t},\n\tgetNamedItemNS: function(namespaceURI, localName) {\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar node = this[i];\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n\n/**\n * The DOMImplementation interface represents an object providing methods\n * which are not dependent on any particular document.\n * Such an object is returned by the `Document.implementation` property.\n *\n * __The individual methods describe the differences compared to the specs.__\n *\n * @constructor\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN\n * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)\n * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core\n * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core\n * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard\n */\nfunction DOMImplementation() {\n}\n\nDOMImplementation.prototype = {\n\t/**\n\t * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.\n\t * The different implementations fairly diverged in what kind of features were reported.\n\t * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.\n\t *\n\t * @deprecated It is deprecated and modern browsers return true in all cases.\n\t *\n\t * @param {string} feature\n\t * @param {string} [version]\n\t * @returns {boolean} always true\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN\n\t * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard\n\t */\n\thasFeature: function(feature, version) {\n\t\t\treturn true;\n\t},\n\t/**\n\t * Creates an XML Document object of the specified type with its document element.\n\t *\n\t * __It behaves slightly different from the description in the living standard__:\n\t * - There is no interface/class `XMLDocument`, it returns a `Document` instance.\n\t * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.\n\t * - this implementation is not validating names or qualified names\n\t *   (when parsing XML strings, the SAX parser takes care of that)\n\t *\n\t * @param {string|null} namespaceURI\n\t * @param {string} qualifiedName\n\t * @param {DocumentType=null} doctype\n\t * @returns {Document}\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core\n\t *\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\n\t */\n\tcreateDocument: function(namespaceURI,  qualifiedName, doctype){\n\t\tvar doc = new Document();\n\t\tdoc.implementation = this;\n\t\tdoc.childNodes = new NodeList();\n\t\tdoc.doctype = doctype || null;\n\t\tif (doctype){\n\t\t\tdoc.appendChild(doctype);\n\t\t}\n\t\tif (qualifiedName){\n\t\t\tvar root = doc.createElementNS(namespaceURI, qualifiedName);\n\t\t\tdoc.appendChild(root);\n\t\t}\n\t\treturn doc;\n\t},\n\t/**\n\t * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.\n\t *\n\t * __This behavior is slightly different from the in the specs__:\n\t * - this implementation is not validating names or qualified names\n\t *   (when parsing XML strings, the SAX parser takes care of that)\n\t *\n\t * @param {string} qualifiedName\n\t * @param {string} [publicId]\n\t * @param {string} [systemId]\n\t * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation\n\t * \t\t\t\t  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard\n\t *\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\n\t */\n\tcreateDocumentType: function(qualifiedName, publicId, systemId){\n\t\tvar node = new DocumentType();\n\t\tnode.name = qualifiedName;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.publicId = publicId || '';\n\t\tnode.systemId = systemId || '';\n\n\t\treturn node;\n\t}\n};\n\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\n */\n\nfunction Node() {\n};\n\nNode.prototype = {\n\tfirstChild : null,\n\tlastChild : null,\n\tpreviousSibling : null,\n\tnextSibling : null,\n\tattributes : null,\n\tparentNode : null,\n\tchildNodes : null,\n\townerDocument : null,\n\tnodeValue : null,\n\tnamespaceURI : null,\n\tprefix : null,\n\tlocalName : null,\n\t// Modified in DOM Level 2:\n\tinsertBefore:function(newChild, refChild){//raises \n\t\treturn _insertBefore(this,newChild,refChild);\n\t},\n\treplaceChild:function(newChild, oldChild){//raises \n\t\tthis.insertBefore(newChild,oldChild);\n\t\tif(oldChild){\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t},\n\tremoveChild:function(oldChild){\n\t\treturn _removeChild(this,oldChild);\n\t},\n\tappendChild:function(newChild){\n\t\treturn this.insertBefore(newChild,null);\n\t},\n\thasChildNodes:function(){\n\t\treturn this.firstChild != null;\n\t},\n\tcloneNode:function(deep){\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\n\t},\n\t// Modified in DOM Level 2:\n\tnormalize:function(){\n\t\tvar child = this.firstChild;\n\t\twhile(child){\n\t\t\tvar next = child.nextSibling;\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\n\t\t\t\tthis.removeChild(next);\n\t\t\t\tchild.appendData(next.data);\n\t\t\t}else{\n\t\t\t\tchild.normalize();\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t}\n\t},\n  \t// Introduced in DOM Level 2:\n\tisSupported:function(feature, version){\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\n\t},\n    // Introduced in DOM Level 2:\n    hasAttributes:function(){\n    \treturn this.attributes.length>0;\n    },\n\t/**\n\t * Look up the prefix associated to the given namespace URI, starting from this node.\n\t * **The default namespace declarations are ignored by this method.**\n\t * See Namespace Prefix Lookup for details on the algorithm used by this method.\n\t *\n\t * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._\n\t *\n\t * @param {string | null} namespaceURI\n\t * @returns {string | null}\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo\n\t * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix\n\t * @see https://github.com/xmldom/xmldom/issues/322\n\t */\n    lookupPrefix:function(namespaceURI){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tfor(var n in map){\n    \t\t\t\tif(map[n] == namespaceURI){\n    \t\t\t\t\treturn n;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    lookupNamespaceURI:function(prefix){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tif(prefix in map){\n    \t\t\t\treturn map[prefix] ;\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    isDefaultNamespace:function(namespaceURI){\n    \tvar prefix = this.lookupPrefix(namespaceURI);\n    \treturn prefix == null;\n    }\n};\n\n\nfunction _xmlEncoder(c){\n\treturn c == '<' && '&lt;' ||\n         c == '>' && '&gt;' ||\n         c == '&' && '&amp;' ||\n         c == '\"' && '&quot;' ||\n         '&#'+c.charCodeAt()+';'\n}\n\n\ncopy(NodeType,Node);\ncopy(NodeType,Node.prototype);\n\n/**\n * @param callback return true for continue,false for break\n * @return boolean true: break visit;\n */\nfunction _visitNode(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(_visitNode(node,callback)){return true}\n        }while(node=node.nextSibling)\n    }\n}\n\n\n\nfunction Document(){\n}\n\nfunction _onAddAttribute(doc,el,newAttr){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns === NAMESPACE.XMLNS){\n\t\t//update namespace\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\n\t}\n}\n\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns === NAMESPACE.XMLNS){\n\t\t//update namespace\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\n\t}\n}\n\n/**\n * Updates `el.childNodes`, updating the indexed items and it's `length`.\n * Passing `newChild` means it will be appended.\n * Otherwise it's assumed that an item has been removed,\n * and `el.firstNode` and it's `.nextSibling` are used\n * to walk the current list of child nodes.\n *\n * @param {Document} doc\n * @param {Node} el\n * @param {Node} [newChild]\n * @private\n */\nfunction _onUpdateChild (doc, el, newChild) {\n\tif(doc && doc._inc){\n\t\tdoc._inc++;\n\t\t//update childNodes\n\t\tvar cs = el.childNodes;\n\t\tif (newChild) {\n\t\t\tcs[cs.length++] = newChild;\n\t\t} else {\n\t\t\tvar child = el.firstChild;\n\t\t\tvar i = 0;\n\t\t\twhile (child) {\n\t\t\t\tcs[i++] = child;\n\t\t\t\tchild = child.nextSibling;\n\t\t\t}\n\t\t\tcs.length = i;\n\t\t\tdelete cs[cs.length];\n\t\t}\n\t}\n}\n\n/**\n * Removes the connections between `parentNode` and `child`\n * and any existing `child.previousSibling` or `child.nextSibling`.\n *\n * @see https://github.com/xmldom/xmldom/issues/135\n * @see https://github.com/xmldom/xmldom/issues/145\n *\n * @param {Node} parentNode\n * @param {Node} child\n * @returns {Node} the child that was removed.\n * @private\n */\nfunction _removeChild (parentNode, child) {\n\tvar previous = child.previousSibling;\n\tvar next = child.nextSibling;\n\tif (previous) {\n\t\tprevious.nextSibling = next;\n\t} else {\n\t\tparentNode.firstChild = next;\n\t}\n\tif (next) {\n\t\tnext.previousSibling = previous;\n\t} else {\n\t\tparentNode.lastChild = previous;\n\t}\n\tchild.parentNode = null;\n\tchild.previousSibling = null;\n\tchild.nextSibling = null;\n\t_onUpdateChild(parentNode.ownerDocument, parentNode);\n\treturn child;\n}\n/**\n * preformance key(refChild == null)\n */\nfunction _insertBefore(parentNode,newChild,nextChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tcp.removeChild(newChild);//remove and update\n\t}\n\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\tvar newFirst = newChild.firstChild;\n\t\tif (newFirst == null) {\n\t\t\treturn newChild;\n\t\t}\n\t\tvar newLast = newChild.lastChild;\n\t}else{\n\t\tnewFirst = newLast = newChild;\n\t}\n\tvar pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\n\n\tnewFirst.previousSibling = pre;\n\tnewLast.nextSibling = nextChild;\n\t\n\t\n\tif(pre){\n\t\tpre.nextSibling = newFirst;\n\t}else{\n\t\tparentNode.firstChild = newFirst;\n\t}\n\tif(nextChild == null){\n\t\tparentNode.lastChild = newLast;\n\t}else{\n\t\tnextChild.previousSibling = newLast;\n\t}\n\tdo{\n\t\tnewFirst.parentNode = parentNode;\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\n\t_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);\n\t//console.log(parentNode.lastChild.nextSibling == null)\n\tif (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n\t\tnewChild.firstChild = newChild.lastChild = null;\n\t}\n\treturn newChild;\n}\n\n/**\n * Appends `newChild` to `parentNode`.\n * If `newChild` is already connected to a `parentNode` it is first removed from it.\n *\n * @see https://github.com/xmldom/xmldom/issues/135\n * @see https://github.com/xmldom/xmldom/issues/145\n * @param {Node} parentNode\n * @param {Node} newChild\n * @returns {Node}\n * @private\n */\nfunction _appendSingleChild (parentNode, newChild) {\n\tif (newChild.parentNode) {\n\t\tnewChild.parentNode.removeChild(newChild);\n\t}\n\tnewChild.parentNode = parentNode;\n\tnewChild.previousSibling = parentNode.lastChild;\n\tnewChild.nextSibling = null;\n\tif (newChild.previousSibling) {\n\t\tnewChild.previousSibling.nextSibling = newChild;\n\t} else {\n\t\tparentNode.firstChild = newChild;\n\t}\n\tparentNode.lastChild = newChild;\n\t_onUpdateChild(parentNode.ownerDocument, parentNode, newChild);\n\treturn newChild;\n}\n\nDocument.prototype = {\n\t//implementation : null,\n\tnodeName :  '#document',\n\tnodeType :  DOCUMENT_NODE,\n\t/**\n\t * The DocumentType node of the document.\n\t *\n\t * @readonly\n\t * @type DocumentType\n\t */\n\tdoctype :  null,\n\tdocumentElement :  null,\n\t_inc : 1,\n\n\tinsertBefore :  function(newChild, refChild){//raises\n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\n\t\t\tvar child = newChild.firstChild;\n\t\t\twhile(child){\n\t\t\t\tvar next = child.nextSibling;\n\t\t\t\tthis.insertBefore(child,refChild);\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t\treturn newChild;\n\t\t}\n\t\tif(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\n\t\treturn _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;\n\t},\n\tremoveChild :  function(oldChild){\n\t\tif(this.documentElement == oldChild){\n\t\t\tthis.documentElement = null;\n\t\t}\n\t\treturn _removeChild(this,oldChild);\n\t},\n\t// Introduced in DOM Level 2:\n\timportNode : function(importedNode,deep){\n\t\treturn importNode(this,importedNode,deep);\n\t},\n\t// Introduced in DOM Level 2:\n\tgetElementById :\tfunction(id){\n\t\tvar rtv = null;\n\t\t_visitNode(this.documentElement,function(node){\n\t\t\tif(node.nodeType == ELEMENT_NODE){\n\t\t\t\tif(node.getAttribute('id') == id){\n\t\t\t\t\trtv = node;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn rtv;\n\t},\n\n\t/**\n\t * The `getElementsByClassName` method of `Document` interface returns an array-like object\n\t * of all child elements which have **all** of the given class name(s).\n\t *\n\t * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.\n\t *\n\t *\n\t * Warning: This is a live LiveNodeList.\n\t * Changes in the DOM will reflect in the array as the changes occur.\n\t * If an element selected by this array no longer qualifies for the selector,\n\t * it will automatically be removed. Be aware of this for iteration purposes.\n\t *\n\t * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n\t * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname\n\t */\n\tgetElementsByClassName: function(classNames) {\n\t\tvar classNamesSet = toOrderedSet(classNames)\n\t\treturn new LiveNodeList(this, function(base) {\n\t\t\tvar ls = [];\n\t\t\tif (classNamesSet.length > 0) {\n\t\t\t\t_visitNode(base.documentElement, function(node) {\n\t\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tvar nodeClassNames = node.getAttribute('class')\n\t\t\t\t\t\t// can be null if the attribute does not exist\n\t\t\t\t\t\tif (nodeClassNames) {\n\t\t\t\t\t\t\t// before splitting and iterating just compare them for the most common case\n\t\t\t\t\t\t\tvar matches = classNames === nodeClassNames;\n\t\t\t\t\t\t\tif (!matches) {\n\t\t\t\t\t\t\t\tvar nodeClassNamesSet = toOrderedSet(nodeClassNames)\n\t\t\t\t\t\t\t\tmatches = classNamesSet.every(arrayIncludes(nodeClassNamesSet))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(matches) {\n\t\t\t\t\t\t\t\tls.push(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ls;\n\t\t});\n\t},\n\n\t//document factory method:\n\tcreateElement :\tfunction(tagName){\n\t\tvar node = new Element();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = tagName;\n\t\tnode.tagName = tagName;\n\t\tnode.localName = tagName;\n\t\tnode.childNodes = new NodeList();\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\tcreateDocumentFragment :\tfunction(){\n\t\tvar node = new DocumentFragment();\n\t\tnode.ownerDocument = this;\n\t\tnode.childNodes = new NodeList();\n\t\treturn node;\n\t},\n\tcreateTextNode :\tfunction(data){\n\t\tvar node = new Text();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateComment :\tfunction(data){\n\t\tvar node = new Comment();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateCDATASection :\tfunction(data){\n\t\tvar node = new CDATASection();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateProcessingInstruction :\tfunction(target,data){\n\t\tvar node = new ProcessingInstruction();\n\t\tnode.ownerDocument = this;\n\t\tnode.tagName = node.target = target;\n\t\tnode.nodeValue= node.data = data;\n\t\treturn node;\n\t},\n\tcreateAttribute :\tfunction(name){\n\t\tvar node = new Attr();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.name = name;\n\t\tnode.nodeName\t= name;\n\t\tnode.localName = name;\n\t\tnode.specified = true;\n\t\treturn node;\n\t},\n\tcreateEntityReference :\tfunction(name){\n\t\tvar node = new EntityReference();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.nodeName\t= name;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Element();\n\t\tvar pl = qualifiedName.split(':');\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tnode.childNodes = new NodeList();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.tagName = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Attr();\n\t\tvar pl = qualifiedName.split(':');\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.name = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tnode.specified = true;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\treturn node;\n\t}\n};\n_extends(Document,Node);\n\n\nfunction Element() {\n\tthis._nsMap = {};\n};\nElement.prototype = {\n\tnodeType : ELEMENT_NODE,\n\thasAttribute : function(name){\n\t\treturn this.getAttributeNode(name)!=null;\n\t},\n\tgetAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name);\n\t\treturn attr && attr.value || '';\n\t},\n\tgetAttributeNode : function(name){\n\t\treturn this.attributes.getNamedItem(name);\n\t},\n\tsetAttribute : function(name, value){\n\t\tvar attr = this.ownerDocument.createAttribute(name);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tremoveAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name)\n\t\tattr && this.removeAttributeNode(attr);\n\t},\n\t\n\t//four real opeartion method\n\tappendChild:function(newChild){\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\t\treturn this.insertBefore(newChild,null);\n\t\t}else{\n\t\t\treturn _appendSingleChild(this,newChild);\n\t\t}\n\t},\n\tsetAttributeNode : function(newAttr){\n\t\treturn this.attributes.setNamedItem(newAttr);\n\t},\n\tsetAttributeNodeNS : function(newAttr){\n\t\treturn this.attributes.setNamedItemNS(newAttr);\n\t},\n\tremoveAttributeNode : function(oldAttr){\n\t\t//console.log(this == oldAttr.ownerElement)\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\n\t},\n\t//get real attribute name,and remove it by removeAttributeNode\n\tremoveAttributeNS : function(namespaceURI, localName){\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\n\t\told && this.removeAttributeNode(old);\n\t},\n\t\n\thasAttributeNS : function(namespaceURI, localName){\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\n\t},\n\tgetAttributeNS : function(namespaceURI, localName){\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\n\t\treturn attr && attr.value || '';\n\t},\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tgetAttributeNodeNS : function(namespaceURI, localName){\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\n\t},\n\t\n\tgetElementsByTagName : function(tagName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t},\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t\t\n\t\t});\n\t}\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n\n_extends(Element,Node);\nfunction Attr() {\n};\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n_extends(Attr,Node);\n\n\nfunction CharacterData() {\n};\nCharacterData.prototype = {\n\tdata : '',\n\tsubstringData : function(offset, count) {\n\t\treturn this.data.substring(offset, offset+count);\n\t},\n\tappendData: function(text) {\n\t\ttext = this.data+text;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t},\n\tinsertData: function(offset,text) {\n\t\tthis.replaceData(offset,0,text);\n\t\n\t},\n\tappendChild:function(newChild){\n\t\tthrow new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])\n\t},\n\tdeleteData: function(offset, count) {\n\t\tthis.replaceData(offset,count,\"\");\n\t},\n\treplaceData: function(offset, count, text) {\n\t\tvar start = this.data.substring(0,offset);\n\t\tvar end = this.data.substring(offset+count);\n\t\ttext = start + text + end;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t}\n}\n_extends(CharacterData,Node);\nfunction Text() {\n};\nText.prototype = {\n\tnodeName : \"#text\",\n\tnodeType : TEXT_NODE,\n\tsplitText : function(offset) {\n\t\tvar text = this.data;\n\t\tvar newText = text.substring(offset);\n\t\ttext = text.substring(0, offset);\n\t\tthis.data = this.nodeValue = text;\n\t\tthis.length = text.length;\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\n\t\tif(this.parentNode){\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\n\t\t}\n\t\treturn newNode;\n\t}\n}\n_extends(Text,CharacterData);\nfunction Comment() {\n};\nComment.prototype = {\n\tnodeName : \"#comment\",\n\tnodeType : COMMENT_NODE\n}\n_extends(Comment,CharacterData);\n\nfunction CDATASection() {\n};\nCDATASection.prototype = {\n\tnodeName : \"#cdata-section\",\n\tnodeType : CDATA_SECTION_NODE\n}\n_extends(CDATASection,CharacterData);\n\n\nfunction DocumentType() {\n};\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n_extends(DocumentType,Node);\n\nfunction Notation() {\n};\nNotation.prototype.nodeType = NOTATION_NODE;\n_extends(Notation,Node);\n\nfunction Entity() {\n};\nEntity.prototype.nodeType = ENTITY_NODE;\n_extends(Entity,Node);\n\nfunction EntityReference() {\n};\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n_extends(EntityReference,Node);\n\nfunction DocumentFragment() {\n};\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\n_extends(DocumentFragment,Node);\n\n\nfunction ProcessingInstruction() {\n}\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n_extends(ProcessingInstruction,Node);\nfunction XMLSerializer(){}\nXMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){\n\treturn nodeSerializeToString.call(node,isHtml,nodeFilter);\n}\nNode.prototype.toString = nodeSerializeToString;\nfunction nodeSerializeToString(isHtml,nodeFilter){\n\tvar buf = [];\n\tvar refNode = this.nodeType == 9 && this.documentElement || this;\n\tvar prefix = refNode.prefix;\n\tvar uri = refNode.namespaceURI;\n\t\n\tif(uri && prefix == null){\n\t\t//console.log(prefix)\n\t\tvar prefix = refNode.lookupPrefix(uri);\n\t\tif(prefix == null){\n\t\t\t//isHTML = true;\n\t\t\tvar visibleNamespaces=[\n\t\t\t{namespace:uri,prefix:null}\n\t\t\t//{namespace:uri,prefix:''}\n\t\t\t]\n\t\t}\n\t}\n\tserializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);\n\t//console.log('###',this.nodeType,uri,prefix,buf.join(''))\n\treturn buf.join('');\n}\n\nfunction needNamespaceDefine(node, isHTML, visibleNamespaces) {\n\tvar prefix = node.prefix || '';\n\tvar uri = node.namespaceURI;\n\t// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,\n\t// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :\n\t// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.\n\t// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)\n\t// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :\n\t// > [...] Furthermore, the attribute value [...] must not be an empty string.\n\t// so serializing empty namespace value like xmlns:ds=\"\" would produce an invalid XML document.\n\tif (!uri) {\n\t\treturn false;\n\t}\n\tif (prefix === \"xml\" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {\n\t\treturn false;\n\t}\n\t\n\tvar i = visibleNamespaces.length \n\twhile (i--) {\n\t\tvar ns = visibleNamespaces[i];\n\t\t// get namespace prefix\n\t\tif (ns.prefix === prefix) {\n\t\t\treturn ns.namespace !== uri;\n\t\t}\n\t}\n\treturn true;\n}\n/**\n * Well-formed constraint: No < in Attribute Values\n * > The replacement text of any entity referred to directly or indirectly\n * > in an attribute value must not contain a <.\n * @see https://www.w3.org/TR/xml11/#CleanAttrVals\n * @see https://www.w3.org/TR/xml11/#NT-AttValue\n *\n * Literal whitespace other than space that appear in attribute values\n * are serialized as their entity references, so they will be preserved.\n * (In contrast to whitespace literals in the input which are normalized to spaces)\n * @see https://www.w3.org/TR/xml11/#AVNormalize\n * @see https://w3c.github.io/DOM-Parsing/#serializing-an-element-s-attributes\n */\nfunction addSerializedAttribute(buf, qualifiedName, value) {\n\tbuf.push(' ', qualifiedName, '=\"', value.replace(/[<>&\"\\t\\n\\r]/g, _xmlEncoder), '\"')\n}\n\nfunction serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\n\tif (!visibleNamespaces) {\n\t\tvisibleNamespaces = [];\n\t}\n\n\tif(nodeFilter){\n\t\tnode = nodeFilter(node);\n\t\tif(node){\n\t\t\tif(typeof node == 'string'){\n\t\t\t\tbuf.push(node);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}else{\n\t\t\treturn;\n\t\t}\n\t\t//buf.sort.apply(attrs, attributeSorter);\n\t}\n\n\tswitch(node.nodeType){\n\tcase ELEMENT_NODE:\n\t\tvar attrs = node.attributes;\n\t\tvar len = attrs.length;\n\t\tvar child = node.firstChild;\n\t\tvar nodeName = node.tagName;\n\t\t\n\t\tisHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML\n\n\t\tvar prefixedNodeName = nodeName\n\t\tif (!isHTML && !node.prefix && node.namespaceURI) {\n\t\t\tvar defaultNS\n\t\t\t// lookup current default ns from `xmlns` attribute\n\t\t\tfor (var ai = 0; ai < attrs.length; ai++) {\n\t\t\t\tif (attrs.item(ai).name === 'xmlns') {\n\t\t\t\t\tdefaultNS = attrs.item(ai).value\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!defaultNS) {\n\t\t\t\t// lookup current default ns in visibleNamespaces\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\n\t\t\t\t\tif (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {\n\t\t\t\t\t\tdefaultNS = namespace.namespace\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (defaultNS !== node.namespaceURI) {\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\n\t\t\t\t\tif (namespace.namespace === node.namespaceURI) {\n\t\t\t\t\t\tif (namespace.prefix) {\n\t\t\t\t\t\t\tprefixedNodeName = namespace.prefix + ':' + nodeName\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbuf.push('<', prefixedNodeName);\n\n\t\tfor(var i=0;i<len;i++){\n\t\t\t// add namespaces for attributes\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (attr.prefix == 'xmlns') {\n\t\t\t\tvisibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });\n\t\t\t}else if(attr.nodeName == 'xmlns'){\n\t\t\t\tvisibleNamespaces.push({ prefix: '', namespace: attr.value });\n\t\t\t}\n\t\t}\n\n\t\tfor(var i=0;i<len;i++){\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {\n\t\t\t\tvar prefix = attr.prefix||'';\n\t\t\t\tvar uri = attr.namespaceURI;\n\t\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n\t\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t\t}\n\t\t\tserializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t}\n\n\t\t// add namespace for current node\t\t\n\t\tif (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {\n\t\t\tvar prefix = node.prefix||'';\n\t\t\tvar uri = node.namespaceURI;\n\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t}\n\t\t\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\n\t\t\tbuf.push('>');\n\t\t\t//if is cdata child node\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\n\t\t\t\twhile(child){\n\t\t\t\t\tif(child.data){\n\t\t\t\t\t\tbuf.push(child.data);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\t\t\t}\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}else\n\t\t\t{\n\t\t\t\twhile(child){\n\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf.push('</',prefixedNodeName,'>');\n\t\t}else{\n\t\t\tbuf.push('/>');\n\t\t}\n\t\t// remove added visible namespaces\n\t\t//visibleNamespaces.length = startVisibleNamespaces;\n\t\treturn;\n\tcase DOCUMENT_NODE:\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t\treturn;\n\tcase ATTRIBUTE_NODE:\n\t\treturn addSerializedAttribute(buf, node.name, node.value);\n\tcase TEXT_NODE:\n\t\t/**\n\t\t * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,\n\t\t * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.\n\t\t * If they are needed elsewhere, they must be escaped using either numeric character references or the strings\n\t\t * `&amp;` and `&lt;` respectively.\n\t\t * The right angle bracket (>) may be represented using the string \" &gt; \", and must, for compatibility,\n\t\t * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,\n\t\t * when that string is not marking the end of a CDATA section.\n\t\t *\n\t\t * In the content of elements, character data is any string of characters\n\t\t * which does not contain the start-delimiter of any markup\n\t\t * and does not include the CDATA-section-close delimiter, `]]>`.\n\t\t *\n\t\t * @see https://www.w3.org/TR/xml/#NT-CharData\n\t\t * @see https://w3c.github.io/DOM-Parsing/#xml-serializing-a-text-node\n\t\t */\n\t\treturn buf.push(node.data\n\t\t\t.replace(/[<&>]/g,_xmlEncoder)\n\t\t);\n\tcase CDATA_SECTION_NODE:\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\n\tcase COMMENT_NODE:\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\n\tcase DOCUMENT_TYPE_NODE:\n\t\tvar pubid = node.publicId;\n\t\tvar sysid = node.systemId;\n\t\tbuf.push('<!DOCTYPE ',node.name);\n\t\tif(pubid){\n\t\t\tbuf.push(' PUBLIC ', pubid);\n\t\t\tif (sysid && sysid!='.') {\n\t\t\t\tbuf.push(' ', sysid);\n\t\t\t}\n\t\t\tbuf.push('>');\n\t\t}else if(sysid && sysid!='.'){\n\t\t\tbuf.push(' SYSTEM ', sysid, '>');\n\t\t}else{\n\t\t\tvar sub = node.internalSubset;\n\t\t\tif(sub){\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\n\t\t\t}\n\t\t\tbuf.push(\">\");\n\t\t}\n\t\treturn;\n\tcase PROCESSING_INSTRUCTION_NODE:\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\n\tcase ENTITY_REFERENCE_NODE:\n\t\treturn buf.push( '&',node.nodeName,';');\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE:\n\tdefault:\n\t\tbuf.push('??',node.nodeName);\n\t}\n}\nfunction importNode(doc,node,deep){\n\tvar node2;\n\tswitch (node.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tnode2 = node.cloneNode(false);\n\t\tnode2.ownerDocument = doc;\n\t\t//var attrs = node2.attributes;\n\t\t//var len = attrs.length;\n\t\t//for(var i=0;i<len;i++){\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n\t\t//}\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tbreak;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t\tbreak;\n\t//case ENTITY_REFERENCE_NODE:\n\t//case PROCESSING_INSTRUCTION_NODE:\n\t////case TEXT_NODE:\n\t//case CDATA_SECTION_NODE:\n\t//case COMMENT_NODE:\n\t//\tdeep = false;\n\t//\tbreak;\n\t//case DOCUMENT_NODE:\n\t//case DOCUMENT_TYPE_NODE:\n\t//cannot be imported.\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE：\n\t//can not hit in level3\n\t//default:throw e;\n\t}\n\tif(!node2){\n\t\tnode2 = node.cloneNode(false);//false\n\t}\n\tnode2.ownerDocument = doc;\n\tnode2.parentNode = null;\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n//\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\nfunction cloneNode(doc,node,deep){\n\tvar node2 = new node.constructor();\n\tfor(var n in node){\n\t\tvar v = node[n];\n\t\tif(typeof v != 'object' ){\n\t\t\tif(v != node2[n]){\n\t\t\t\tnode2[n] = v;\n\t\t\t}\n\t\t}\n\t}\n\tif(node.childNodes){\n\t\tnode2.childNodes = new NodeList();\n\t}\n\tnode2.ownerDocument = doc;\n\tswitch (node2.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tvar attrs\t= node.attributes;\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\n\t\tvar len = attrs.length\n\t\tattrs2._ownerElement = node2;\n\t\tfor(var i=0;i<len;i++){\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\n\t\t}\n\t\tbreak;;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t}\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n\nfunction __set__(object,key,value){\n\tobject[key] = value\n}\n//do dynamic\ntry{\n\tif(Object.defineProperty){\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\n\t\t\tget:function(){\n\t\t\t\t_updateLiveList(this);\n\t\t\t\treturn this.$$length;\n\t\t\t}\n\t\t});\n\n\t\tObject.defineProperty(Node.prototype,'textContent',{\n\t\t\tget:function(){\n\t\t\t\treturn getTextContent(this);\n\t\t\t},\n\n\t\t\tset:function(data){\n\t\t\t\tswitch(this.nodeType){\n\t\t\t\tcase ELEMENT_NODE:\n\t\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\t\twhile(this.firstChild){\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tif(data || String(data)){\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.value = data;\n\t\t\t\t\tthis.nodeValue = data;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t\tfunction getTextContent(node){\n\t\t\tswitch(node.nodeType){\n\t\t\tcase ELEMENT_NODE:\n\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tvar buf = [];\n\t\t\t\tnode = node.firstChild;\n\t\t\t\twhile(node){\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\n\t\t\t\t\t\tbuf.push(getTextContent(node));\n\t\t\t\t\t}\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t\treturn buf.join('');\n\t\t\tdefault:\n\t\t\t\treturn node.nodeValue;\n\t\t\t}\n\t\t}\n\n\t\t__set__ = function(object,key,value){\n\t\t\t//console.log(value)\n\t\t\tobject['$$'+key] = value\n\t\t}\n\t}\n}catch(e){//ie8\n}\n\n//if(typeof require == 'function'){\n\texports.DocumentType = DocumentType;\n\texports.DOMException = DOMException;\n\texports.DOMImplementation = DOMImplementation;\n\texports.Element = Element;\n\texports.Node = Node;\n\texports.NodeList = NodeList;\n\texports.XMLSerializer = XMLSerializer;\n//}\n","var freeze = require('./conventions').freeze;\n\n/**\n * The entities that are predefined in every XML document.\n *\n * @see https://www.w3.org/TR/2006/REC-xml11-20060816/#sec-predefined-ent W3C XML 1.1\n * @see https://www.w3.org/TR/2008/REC-xml-20081126/#sec-predefined-ent W3C XML 1.0\n * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Predefined_entities_in_XML Wikipedia\n */\nexports.XML_ENTITIES = freeze({amp:'&', apos:\"'\", gt:'>', lt:'<', quot:'\"'})\n\n/**\n * A map of currently 241 entities that are detected in an HTML document.\n * They contain all entries from `XML_ENTITIES`.\n *\n * @see XML_ENTITIES\n * @see DOMParser.parseFromString\n * @see DOMImplementation.prototype.createHTMLDocument\n * @see https://html.spec.whatwg.org/#named-character-references WHATWG HTML(5) Spec\n * @see https://www.w3.org/TR/xml-entity-names/ W3C XML Entity Names\n * @see https://www.w3.org/TR/html4/sgml/entities.html W3C HTML4/SGML\n * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML Wikipedia (HTML)\n * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Entities_representing_special_characters_in_XHTML Wikpedia (XHTML)\n */\nexports.HTML_ENTITIES = freeze({\n       lt: '<',\n       gt: '>',\n       amp: '&',\n       quot: '\"',\n       apos: \"'\",\n       Agrave: \"À\",\n       Aacute: \"Á\",\n       Acirc: \"Â\",\n       Atilde: \"Ã\",\n       Auml: \"Ä\",\n       Aring: \"Å\",\n       AElig: \"Æ\",\n       Ccedil: \"Ç\",\n       Egrave: \"È\",\n       Eacute: \"É\",\n       Ecirc: \"Ê\",\n       Euml: \"Ë\",\n       Igrave: \"Ì\",\n       Iacute: \"Í\",\n       Icirc: \"Î\",\n       Iuml: \"Ï\",\n       ETH: \"Ð\",\n       Ntilde: \"Ñ\",\n       Ograve: \"Ò\",\n       Oacute: \"Ó\",\n       Ocirc: \"Ô\",\n       Otilde: \"Õ\",\n       Ouml: \"Ö\",\n       Oslash: \"Ø\",\n       Ugrave: \"Ù\",\n       Uacute: \"Ú\",\n       Ucirc: \"Û\",\n       Uuml: \"Ü\",\n       Yacute: \"Ý\",\n       THORN: \"Þ\",\n       szlig: \"ß\",\n       agrave: \"à\",\n       aacute: \"á\",\n       acirc: \"â\",\n       atilde: \"ã\",\n       auml: \"ä\",\n       aring: \"å\",\n       aelig: \"æ\",\n       ccedil: \"ç\",\n       egrave: \"è\",\n       eacute: \"é\",\n       ecirc: \"ê\",\n       euml: \"ë\",\n       igrave: \"ì\",\n       iacute: \"í\",\n       icirc: \"î\",\n       iuml: \"ï\",\n       eth: \"ð\",\n       ntilde: \"ñ\",\n       ograve: \"ò\",\n       oacute: \"ó\",\n       ocirc: \"ô\",\n       otilde: \"õ\",\n       ouml: \"ö\",\n       oslash: \"ø\",\n       ugrave: \"ù\",\n       uacute: \"ú\",\n       ucirc: \"û\",\n       uuml: \"ü\",\n       yacute: \"ý\",\n       thorn: \"þ\",\n       yuml: \"ÿ\",\n       nbsp: \"\\u00a0\",\n       iexcl: \"¡\",\n       cent: \"¢\",\n       pound: \"£\",\n       curren: \"¤\",\n       yen: \"¥\",\n       brvbar: \"¦\",\n       sect: \"§\",\n       uml: \"¨\",\n       copy: \"©\",\n       ordf: \"ª\",\n       laquo: \"«\",\n       not: \"¬\",\n       shy: \"­­\",\n       reg: \"®\",\n       macr: \"¯\",\n       deg: \"°\",\n       plusmn: \"±\",\n       sup2: \"²\",\n       sup3: \"³\",\n       acute: \"´\",\n       micro: \"µ\",\n       para: \"¶\",\n       middot: \"·\",\n       cedil: \"¸\",\n       sup1: \"¹\",\n       ordm: \"º\",\n       raquo: \"»\",\n       frac14: \"¼\",\n       frac12: \"½\",\n       frac34: \"¾\",\n       iquest: \"¿\",\n       times: \"×\",\n       divide: \"÷\",\n       forall: \"∀\",\n       part: \"∂\",\n       exist: \"∃\",\n       empty: \"∅\",\n       nabla: \"∇\",\n       isin: \"∈\",\n       notin: \"∉\",\n       ni: \"∋\",\n       prod: \"∏\",\n       sum: \"∑\",\n       minus: \"−\",\n       lowast: \"∗\",\n       radic: \"√\",\n       prop: \"∝\",\n       infin: \"∞\",\n       ang: \"∠\",\n       and: \"∧\",\n       or: \"∨\",\n       cap: \"∩\",\n       cup: \"∪\",\n       'int': \"∫\",\n       there4: \"∴\",\n       sim: \"∼\",\n       cong: \"≅\",\n       asymp: \"≈\",\n       ne: \"≠\",\n       equiv: \"≡\",\n       le: \"≤\",\n       ge: \"≥\",\n       sub: \"⊂\",\n       sup: \"⊃\",\n       nsub: \"⊄\",\n       sube: \"⊆\",\n       supe: \"⊇\",\n       oplus: \"⊕\",\n       otimes: \"⊗\",\n       perp: \"⊥\",\n       sdot: \"⋅\",\n       Alpha: \"Α\",\n       Beta: \"Β\",\n       Gamma: \"Γ\",\n       Delta: \"Δ\",\n       Epsilon: \"Ε\",\n       Zeta: \"Ζ\",\n       Eta: \"Η\",\n       Theta: \"Θ\",\n       Iota: \"Ι\",\n       Kappa: \"Κ\",\n       Lambda: \"Λ\",\n       Mu: \"Μ\",\n       Nu: \"Ν\",\n       Xi: \"Ξ\",\n       Omicron: \"Ο\",\n       Pi: \"Π\",\n       Rho: \"Ρ\",\n       Sigma: \"Σ\",\n       Tau: \"Τ\",\n       Upsilon: \"Υ\",\n       Phi: \"Φ\",\n       Chi: \"Χ\",\n       Psi: \"Ψ\",\n       Omega: \"Ω\",\n       alpha: \"α\",\n       beta: \"β\",\n       gamma: \"γ\",\n       delta: \"δ\",\n       epsilon: \"ε\",\n       zeta: \"ζ\",\n       eta: \"η\",\n       theta: \"θ\",\n       iota: \"ι\",\n       kappa: \"κ\",\n       lambda: \"λ\",\n       mu: \"μ\",\n       nu: \"ν\",\n       xi: \"ξ\",\n       omicron: \"ο\",\n       pi: \"π\",\n       rho: \"ρ\",\n       sigmaf: \"ς\",\n       sigma: \"σ\",\n       tau: \"τ\",\n       upsilon: \"υ\",\n       phi: \"φ\",\n       chi: \"χ\",\n       psi: \"ψ\",\n       omega: \"ω\",\n       thetasym: \"ϑ\",\n       upsih: \"ϒ\",\n       piv: \"ϖ\",\n       OElig: \"Œ\",\n       oelig: \"œ\",\n       Scaron: \"Š\",\n       scaron: \"š\",\n       Yuml: \"Ÿ\",\n       fnof: \"ƒ\",\n       circ: \"ˆ\",\n       tilde: \"˜\",\n       ensp: \" \",\n       emsp: \" \",\n       thinsp: \" \",\n       zwnj: \"‌\",\n       zwj: \"‍\",\n       lrm: \"‎\",\n       rlm: \"‏\",\n       ndash: \"–\",\n       mdash: \"—\",\n       lsquo: \"‘\",\n       rsquo: \"’\",\n       sbquo: \"‚\",\n       ldquo: \"“\",\n       rdquo: \"”\",\n       bdquo: \"„\",\n       dagger: \"†\",\n       Dagger: \"‡\",\n       bull: \"•\",\n       hellip: \"…\",\n       permil: \"‰\",\n       prime: \"′\",\n       Prime: \"″\",\n       lsaquo: \"‹\",\n       rsaquo: \"›\",\n       oline: \"‾\",\n       euro: \"€\",\n       trade: \"™\",\n       larr: \"←\",\n       uarr: \"↑\",\n       rarr: \"→\",\n       darr: \"↓\",\n       harr: \"↔\",\n       crarr: \"↵\",\n       lceil: \"⌈\",\n       rceil: \"⌉\",\n       lfloor: \"⌊\",\n       rfloor: \"⌋\",\n       loz: \"◊\",\n       spades: \"♠\",\n       clubs: \"♣\",\n       hearts: \"♥\",\n       diams: \"♦\"\n});\n\n/**\n * @deprecated use `HTML_ENTITIES` instead\n * @see HTML_ENTITIES\n */\nexports.entityMap = exports.HTML_ENTITIES\n","var dom = require('./dom')\nexports.DOMImplementation = dom.DOMImplementation\nexports.XMLSerializer = dom.XMLSerializer\nexports.DOMParser = require('./dom-parser').DOMParser\n","var NAMESPACE = require(\"./conventions\").NAMESPACE;\n\n//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040]\");\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\n\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\nvar S_TAG = 0;//tag name offerring\nvar S_ATTR = 1;//attr name offerring\nvar S_ATTR_SPACE=2;//attr name end and space offer\nvar S_EQ = 3;//=space?\nvar S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)\nvar S_ATTR_END = 5;//attr value end and no space(quot end)\nvar S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)\nvar S_TAG_CLOSE = 7;//closed el<el />\n\n/**\n * Creates an error that will not be caught by XMLReader aka the SAX parser.\n *\n * @param {string} message\n * @param {any?} locator Optional, can provide details about the location in the source\n * @constructor\n */\nfunction ParseError(message, locator) {\n\tthis.message = message\n\tthis.locator = locator\n\tif(Error.captureStackTrace) Error.captureStackTrace(this, ParseError);\n}\nParseError.prototype = new Error();\nParseError.prototype.name = ParseError.name\n\nfunction XMLReader(){\n\n}\n\nXMLReader.prototype = {\n\tparse:function(source,defaultNSMap,entityMap){\n\t\tvar domBuilder = this.domBuilder;\n\t\tdomBuilder.startDocument();\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\n\t\tparse(source,defaultNSMap,entityMap,\n\t\t\t\tdomBuilder,this.errorHandler);\n\t\tdomBuilder.endDocument();\n\t}\n}\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\n\tfunction fixedFromCharCode(code) {\n\t\t// String.prototype.fromCharCode does not supports\n\t\t// > 2 bytes unicode chars directly\n\t\tif (code > 0xffff) {\n\t\t\tcode -= 0x10000;\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\n\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\n\t\t} else {\n\t\t\treturn String.fromCharCode(code);\n\t\t}\n\t}\n\tfunction entityReplacer(a){\n\t\tvar k = a.slice(1,-1);\n\t\tif (Object.hasOwnProperty.call(entityMap, k)) {\n\t\t\treturn entityMap[k];\n\t\t}else if(k.charAt(0) === '#'){\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\n\t\t}else{\n\t\t\terrorHandler.error('entity not found:'+a);\n\t\t\treturn a;\n\t\t}\n\t}\n\tfunction appendText(end){//has some bugs\n\t\tif(end>start){\n\t\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\n\t\t\tlocator&&position(start);\n\t\t\tdomBuilder.characters(xt,0,end-start);\n\t\t\tstart = end\n\t\t}\n\t}\n\tfunction position(p,m){\n\t\twhile(p>=lineEnd && (m = linePattern.exec(source))){\n\t\t\tlineStart = m.index;\n\t\t\tlineEnd = lineStart + m[0].length;\n\t\t\tlocator.lineNumber++;\n\t\t\t//console.log('line++:',locator,startPos,endPos)\n\t\t}\n\t\tlocator.columnNumber = p-lineStart+1;\n\t}\n\tvar lineStart = 0;\n\tvar lineEnd = 0;\n\tvar linePattern = /.*(?:\\r\\n?|\\n)|.*$/g\n\tvar locator = domBuilder.locator;\n\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\n\tvar closeMap = {};\n\tvar start = 0;\n\twhile(true){\n\t\ttry{\n\t\t\tvar tagStart = source.indexOf('<',start);\n\t\t\tif(tagStart<0){\n\t\t\t\tif(!source.substr(start).match(/^\\s*$/)){\n\t\t\t\t\tvar doc = domBuilder.doc;\n\t    \t\t\tvar text = doc.createTextNode(source.substr(start));\n\t    \t\t\tdoc.appendChild(text);\n\t    \t\t\tdomBuilder.currentElement = text;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(tagStart>start){\n\t\t\t\tappendText(tagStart);\n\t\t\t}\n\t\t\tswitch(source.charAt(tagStart+1)){\n\t\t\tcase '/':\n\t\t\t\tvar end = source.indexOf('>',tagStart+3);\n\t\t\t\tvar tagName = source.substring(tagStart + 2, end).replace(/[ \\t\\n\\r]+$/g, '');\n\t\t\t\tvar config = parseStack.pop();\n\t\t\t\tif(end<0){\n\n\t        \t\ttagName = source.substring(tagStart+2).replace(/[\\s<].*/,'');\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' is not complete:'+config.tagName);\n\t        \t\tend = tagStart+1+tagName.length;\n\t        \t}else if(tagName.match(/\\s</)){\n\t        \t\ttagName = tagName.replace(/[\\s<].*/,'');\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' maybe not complete');\n\t        \t\tend = tagStart+1+tagName.length;\n\t\t\t\t}\n\t\t\t\tvar localNSMap = config.localNSMap;\n\t\t\t\tvar endMatch = config.tagName == tagName;\n\t\t\t\tvar endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()\n\t\t        if(endIgnoreCaseMach){\n\t\t        \tdomBuilder.endElement(config.uri,config.localName,tagName);\n\t\t\t\t\tif(localNSMap){\n\t\t\t\t\t\tfor(var prefix in localNSMap){\n\t\t\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(!endMatch){\n\t\t            \terrorHandler.fatalError(\"end tag name: \"+tagName+' is not match the current start tagName:'+config.tagName ); // No known test case\n\t\t\t\t\t}\n\t\t        }else{\n\t\t        \tparseStack.push(config)\n\t\t        }\n\n\t\t\t\tend++;\n\t\t\t\tbreak;\n\t\t\t\t// end elment\n\t\t\tcase '?':// <?...?>\n\t\t\t\tlocator&&position(tagStart);\n\t\t\t\tend = parseInstruction(source,tagStart,domBuilder);\n\t\t\t\tbreak;\n\t\t\tcase '!':// <!doctype,<![CDATA,<!--\n\t\t\t\tlocator&&position(tagStart);\n\t\t\t\tend = parseDCC(source,tagStart,domBuilder,errorHandler);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlocator&&position(tagStart);\n\t\t\t\tvar el = new ElementAttributes();\n\t\t\t\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\n\t\t\t\t//elStartEnd\n\t\t\t\tvar end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);\n\t\t\t\tvar len = el.length;\n\n\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\n\t\t\t\t\tel.closed = true;\n\t\t\t\t\tif(!entityMap.nbsp){\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(locator && len){\n\t\t\t\t\tvar locator2 = copyLocator(locator,{});\n\t\t\t\t\t//try{//attribute position fixed\n\t\t\t\t\tfor(var i = 0;i<len;i++){\n\t\t\t\t\t\tvar a = el[i];\n\t\t\t\t\t\tposition(a.offset);\n\t\t\t\t\t\ta.locator = copyLocator(locator,{});\n\t\t\t\t\t}\n\t\t\t\t\tdomBuilder.locator = locator2\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\n\t\t\t\t\t\tparseStack.push(el)\n\t\t\t\t\t}\n\t\t\t\t\tdomBuilder.locator = locator;\n\t\t\t\t}else{\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\n\t\t\t\t\t\tparseStack.push(el)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (NAMESPACE.isHTML(el.uri) && !el.closed) {\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\n\t\t\t\t} else {\n\t\t\t\t\tend++;\n\t\t\t\t}\n\t\t\t}\n\t\t}catch(e){\n\t\t\tif (e instanceof ParseError) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\terrorHandler.error('element parse error: '+e)\n\t\t\tend = -1;\n\t\t}\n\t\tif(end>start){\n\t\t\tstart = end;\n\t\t}else{\n\t\t\t//TODO: 这里有可能sax回退，有位置错误风险\n\t\t\tappendText(Math.max(tagStart,start)+1);\n\t\t}\n\t}\n}\nfunction copyLocator(f,t){\n\tt.lineNumber = f.lineNumber;\n\tt.columnNumber = f.columnNumber;\n\treturn t;\n}\n\n/**\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\n */\nfunction parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){\n\n\t/**\n\t * @param {string} qname\n\t * @param {string} value\n\t * @param {number} startIndex\n\t */\n\tfunction addAttribute(qname, value, startIndex) {\n\t\tif (el.attributeNames.hasOwnProperty(qname)) {\n\t\t\terrorHandler.fatalError('Attribute ' + qname + ' redefined')\n\t\t}\n\t\tel.addValue(\n\t\t\tqname,\n\t\t\t// @see https://www.w3.org/TR/xml/#AVNormalize\n\t\t\t// since the xmldom sax parser does not \"interpret\" DTD the following is not implemented:\n\t\t\t// - recursive replacement of (DTD) entity references\n\t\t\t// - trimming and collapsing multiple spaces into a single one for attributes that are not of type CDATA\n\t\t\tvalue.replace(/[\\t\\n\\r]/g, ' ').replace(/&#?\\w+;/g, entityReplacer),\n\t\t\tstartIndex\n\t\t)\n\t}\n\tvar attrName;\n\tvar value;\n\tvar p = ++start;\n\tvar s = S_TAG;//status\n\twhile(true){\n\t\tvar c = source.charAt(p);\n\t\tswitch(c){\n\t\tcase '=':\n\t\t\tif(s === S_ATTR){//attrName\n\t\t\t\tattrName = source.slice(start,p);\n\t\t\t\ts = S_EQ;\n\t\t\t}else if(s === S_ATTR_SPACE){\n\t\t\t\ts = S_EQ;\n\t\t\t}else{\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\n\t\t\t\tthrow new Error('attribute equal must after attrName'); // No known test case\n\t\t\t}\n\t\t\tbreak;\n\t\tcase '\\'':\n\t\tcase '\"':\n\t\t\tif(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE\n\t\t\t\t){//equal\n\t\t\t\tif(s === S_ATTR){\n\t\t\t\t\terrorHandler.warning('attribute value must after \"=\"')\n\t\t\t\t\tattrName = source.slice(start,p)\n\t\t\t\t}\n\t\t\t\tstart = p+1;\n\t\t\t\tp = source.indexOf(c,start)\n\t\t\t\tif(p>0){\n\t\t\t\t\tvalue = source.slice(start, p);\n\t\t\t\t\taddAttribute(attrName, value, start-1);\n\t\t\t\t\ts = S_ATTR_END;\n\t\t\t\t}else{\n\t\t\t\t\t//fatalError: no end quot match\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\n\t\t\t\t}\n\t\t\t}else if(s == S_ATTR_NOQUOT_VALUE){\n\t\t\t\tvalue = source.slice(start, p);\n\t\t\t\taddAttribute(attrName, value, start);\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\n\t\t\t\tstart = p+1;\n\t\t\t\ts = S_ATTR_END\n\t\t\t}else{\n\t\t\t\t//fatalError: no equal before\n\t\t\t\tthrow new Error('attribute value must after \"=\"'); // No known test case\n\t\t\t}\n\t\t\tbreak;\n\t\tcase '/':\n\t\t\tswitch(s){\n\t\t\tcase S_TAG:\n\t\t\t\tel.setTagName(source.slice(start,p));\n\t\t\tcase S_ATTR_END:\n\t\t\tcase S_TAG_SPACE:\n\t\t\tcase S_TAG_CLOSE:\n\t\t\t\ts =S_TAG_CLOSE;\n\t\t\t\tel.closed = true;\n\t\t\tcase S_ATTR_NOQUOT_VALUE:\n\t\t\tcase S_ATTR:\n\t\t\tcase S_ATTR_SPACE:\n\t\t\t\tbreak;\n\t\t\t//case S_EQ:\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\") // No known test case\n\t\t\t}\n\t\t\tbreak;\n\t\tcase ''://end document\n\t\t\terrorHandler.error('unexpected end of input');\n\t\t\tif(s == S_TAG){\n\t\t\t\tel.setTagName(source.slice(start,p));\n\t\t\t}\n\t\t\treturn p;\n\t\tcase '>':\n\t\t\tswitch(s){\n\t\t\tcase S_TAG:\n\t\t\t\tel.setTagName(source.slice(start,p));\n\t\t\tcase S_ATTR_END:\n\t\t\tcase S_TAG_SPACE:\n\t\t\tcase S_TAG_CLOSE:\n\t\t\t\tbreak;//normal\n\t\t\tcase S_ATTR_NOQUOT_VALUE://Compatible state\n\t\t\tcase S_ATTR:\n\t\t\t\tvalue = source.slice(start,p);\n\t\t\t\tif(value.slice(-1) === '/'){\n\t\t\t\t\tel.closed  = true;\n\t\t\t\t\tvalue = value.slice(0,-1)\n\t\t\t\t}\n\t\t\tcase S_ATTR_SPACE:\n\t\t\t\tif(s === S_ATTR_SPACE){\n\t\t\t\t\tvalue = attrName;\n\t\t\t\t}\n\t\t\t\tif(s == S_ATTR_NOQUOT_VALUE){\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!');\n\t\t\t\t\taddAttribute(attrName, value, start)\n\t\t\t\t}else{\n\t\t\t\t\tif(!NAMESPACE.isHTML(currentNSMap['']) || !value.match(/^(?:disabled|checked|selected)$/i)){\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\n\t\t\t\t\t}\n\t\t\t\t\taddAttribute(value, value, start)\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase S_EQ:\n\t\t\t\tthrow new Error('attribute value missed!!');\n\t\t\t}\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\n\t\t\treturn p;\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\n\t\tcase '\\u0080':\n\t\t\tc = ' ';\n\t\tdefault:\n\t\t\tif(c<= ' '){//space\n\t\t\t\tswitch(s){\n\t\t\t\tcase S_TAG:\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\n\t\t\t\t\ts = S_TAG_SPACE;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_ATTR:\n\t\t\t\t\tattrName = source.slice(start,p)\n\t\t\t\t\ts = S_ATTR_SPACE;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_ATTR_NOQUOT_VALUE:\n\t\t\t\t\tvar value = source.slice(start, p);\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\n\t\t\t\t\taddAttribute(attrName, value, start)\n\t\t\t\tcase S_ATTR_END:\n\t\t\t\t\ts = S_TAG_SPACE;\n\t\t\t\t\tbreak;\n\t\t\t\t//case S_TAG_SPACE:\n\t\t\t\t//case S_EQ:\n\t\t\t\t//case S_ATTR_SPACE:\n\t\t\t\t//\tvoid();break;\n\t\t\t\t//case S_TAG_CLOSE:\n\t\t\t\t\t//ignore warning\n\t\t\t\t}\n\t\t\t}else{//not space\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\n\t\t\t\tswitch(s){\n\t\t\t\t//case S_TAG:void();break;\n\t\t\t\t//case S_ATTR:void();break;\n\t\t\t\t//case S_ATTR_NOQUOT_VALUE:void();break;\n\t\t\t\tcase S_ATTR_SPACE:\n\t\t\t\t\tvar tagName =  el.tagName;\n\t\t\t\t\tif (!NAMESPACE.isHTML(currentNSMap['']) || !attrName.match(/^(?:disabled|checked|selected)$/i)) {\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead2!!')\n\t\t\t\t\t}\n\t\t\t\t\taddAttribute(attrName, attrName, start);\n\t\t\t\t\tstart = p;\n\t\t\t\t\ts = S_ATTR;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_ATTR_END:\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\n\t\t\t\tcase S_TAG_SPACE:\n\t\t\t\t\ts = S_ATTR;\n\t\t\t\t\tstart = p;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_EQ:\n\t\t\t\t\ts = S_ATTR_NOQUOT_VALUE;\n\t\t\t\t\tstart = p;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_TAG_CLOSE:\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\n\t\t\t\t}\n\t\t\t}\n\t\t}//end outer switch\n\t\t//console.log('p++',p)\n\t\tp++;\n\t}\n}\n/**\n * @return true if has new namespace define\n */\nfunction appendElement(el,domBuilder,currentNSMap){\n\tvar tagName = el.tagName;\n\tvar localNSMap = null;\n\t//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;\n\tvar i = el.length;\n\twhile(i--){\n\t\tvar a = el[i];\n\t\tvar qName = a.qName;\n\t\tvar value = a.value;\n\t\tvar nsp = qName.indexOf(':');\n\t\tif(nsp>0){\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\n\t\t\tvar localName = qName.slice(nsp+1);\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\n\t\t}else{\n\t\t\tlocalName = qName;\n\t\t\tprefix = null\n\t\t\tnsPrefix = qName === 'xmlns' && ''\n\t\t}\n\t\t//can not set prefix,because prefix !== ''\n\t\ta.localName = localName ;\n\t\t//prefix == null for no ns prefix attribute\n\t\tif(nsPrefix !== false){//hack!!\n\t\t\tif(localNSMap == null){\n\t\t\t\tlocalNSMap = {}\n\t\t\t\t//console.log(currentNSMap,0)\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\n\t\t\t\t//console.log(currentNSMap,1)\n\t\t\t}\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\n\t\t\ta.uri = NAMESPACE.XMLNS\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value)\n\t\t}\n\t}\n\tvar i = el.length;\n\twhile(i--){\n\t\ta = el[i];\n\t\tvar prefix = a.prefix;\n\t\tif(prefix){//no prefix attribute has no namespace\n\t\t\tif(prefix === 'xml'){\n\t\t\t\ta.uri = NAMESPACE.XML;\n\t\t\t}if(prefix !== 'xmlns'){\n\t\t\t\ta.uri = currentNSMap[prefix || '']\n\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\n\t\t\t}\n\t\t}\n\t}\n\tvar nsp = tagName.indexOf(':');\n\tif(nsp>0){\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\n\t}else{\n\t\tprefix = null;//important!!\n\t\tlocalName = el.localName = tagName;\n\t}\n\t//no prefix element has default namespace\n\tvar ns = el.uri = currentNSMap[prefix || ''];\n\tdomBuilder.startElement(ns,localName,tagName,el);\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\n\t//localNSMap = null\n\tif(el.closed){\n\t\tdomBuilder.endElement(ns,localName,tagName);\n\t\tif(localNSMap){\n\t\t\tfor(prefix in localNSMap){\n\t\t\t\tdomBuilder.endPrefixMapping(prefix)\n\t\t\t}\n\t\t}\n\t}else{\n\t\tel.currentNSMap = currentNSMap;\n\t\tel.localNSMap = localNSMap;\n\t\t//parseStack.push(el);\n\t\treturn true;\n\t}\n}\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\n\tif(/^(?:script|textarea)$/i.test(tagName)){\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\n\t\tif(/[&<]/.test(text)){\n\t\t\tif(/^script$/i.test(tagName)){\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\n\t\t\t\t\t//lexHandler.startCDATA();\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\n\t\t\t\t\t//lexHandler.endCDATA();\n\t\t\t\t\treturn elEndStart;\n\t\t\t\t//}\n\t\t\t}//}else{//text area\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\n\t\t\t\tdomBuilder.characters(text,0,text.length);\n\t\t\t\treturn elEndStart;\n\t\t\t//}\n\n\t\t}\n\t}\n\treturn elStartEnd+1;\n}\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\n\t//if(tagName in closeMap){\n\tvar pos = closeMap[tagName];\n\tif(pos == null){\n\t\t//console.log(tagName)\n\t\tpos =  source.lastIndexOf('</'+tagName+'>')\n\t\tif(pos<elStartEnd){//忘记闭合\n\t\t\tpos = source.lastIndexOf('</'+tagName)\n\t\t}\n\t\tcloseMap[tagName] =pos\n\t}\n\treturn pos<elStartEnd;\n\t//}\n}\nfunction _copy(source,target){\n\tfor(var n in source){target[n] = source[n]}\n}\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\n\tvar next= source.charAt(start+2)\n\tswitch(next){\n\tcase '-':\n\t\tif(source.charAt(start + 3) === '-'){\n\t\t\tvar end = source.indexOf('-->',start+4);\n\t\t\t//append comment source.substring(4,end)//<!--\n\t\t\tif(end>start){\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\n\t\t\t\treturn end+3;\n\t\t\t}else{\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}else{\n\t\t\t//error\n\t\t\treturn -1;\n\t\t}\n\tdefault:\n\t\tif(source.substr(start+3,6) == 'CDATA['){\n\t\t\tvar end = source.indexOf(']]>',start+9);\n\t\t\tdomBuilder.startCDATA();\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\n\t\t\tdomBuilder.endCDATA()\n\t\t\treturn end+3;\n\t\t}\n\t\t//<!DOCTYPE\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId)\n\t\tvar matchs = split(source,start);\n\t\tvar len = matchs.length;\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\n\t\t\tvar name = matchs[1][0];\n\t\t\tvar pubid = false;\n\t\t\tvar sysid = false;\n\t\t\tif(len>3){\n\t\t\t\tif(/^public$/i.test(matchs[2][0])){\n\t\t\t\t\tpubid = matchs[3][0];\n\t\t\t\t\tsysid = len>4 && matchs[4][0];\n\t\t\t\t}else if(/^system$/i.test(matchs[2][0])){\n\t\t\t\t\tsysid = matchs[3][0];\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar lastMatch = matchs[len-1]\n\t\t\tdomBuilder.startDTD(name, pubid, sysid);\n\t\t\tdomBuilder.endDTD();\n\n\t\t\treturn lastMatch.index+lastMatch[0].length\n\t\t}\n\t}\n\treturn -1;\n}\n\n\n\nfunction parseInstruction(source,start,domBuilder){\n\tvar end = source.indexOf('?>',start);\n\tif(end){\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\n\t\tif(match){\n\t\t\tvar len = match[0].length;\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\n\t\t\treturn end+2;\n\t\t}else{//error\n\t\t\treturn -1;\n\t\t}\n\t}\n\treturn -1;\n}\n\nfunction ElementAttributes(){\n\tthis.attributeNames = {}\n}\nElementAttributes.prototype = {\n\tsetTagName:function(tagName){\n\t\tif(!tagNamePattern.test(tagName)){\n\t\t\tthrow new Error('invalid tagName:'+tagName)\n\t\t}\n\t\tthis.tagName = tagName\n\t},\n\taddValue:function(qName, value, offset) {\n\t\tif(!tagNamePattern.test(qName)){\n\t\t\tthrow new Error('invalid attribute:'+qName)\n\t\t}\n\t\tthis.attributeNames[qName] = this.length;\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\n\t},\n\tlength:0,\n\tgetLocalName:function(i){return this[i].localName},\n\tgetLocator:function(i){return this[i].locator},\n\tgetQName:function(i){return this[i].qName},\n\tgetURI:function(i){return this[i].uri},\n\tgetValue:function(i){return this[i].value}\n//\t,getIndex:function(uri, localName)){\n//\t\tif(localName){\n//\n//\t\t}else{\n//\t\t\tvar qName = uri\n//\t\t}\n//\t},\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\n//\tgetType:function(uri,localName){}\n//\tgetType:function(i){},\n}\n\n\n\nfunction split(source,start){\n\tvar match;\n\tvar buf = [];\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\n\treg.lastIndex = start;\n\treg.exec(source);//skip <\n\twhile(match = reg.exec(source)){\n\t\tbuf.push(match);\n\t\tif(match[1])return buf;\n\t}\n}\n\nexports.XMLReader = XMLReader;\nexports.ParseError = ParseError;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\"use strict\";\r\nvar app = require('./app');\r\napp.main();\r\n"],"names":["svgNamespace","midpoint","point1","point2","x","y","halveCubicBezier","control1","control2","straightMidpoint","m1","m2","m3","q1","q2","polarToCartesian","angleRadians","length","Math","cos","sin","normalizeAngle","PI","deg2rad","angleDegrees","emergencyColor","gradientColorForValue","gradient","colorType","value","type","stops","lastStop","r","g","b","position","foundMatch","i","posFrom","rFrom","Number","parseInt","substr","gFrom","bFrom","posTo","rTo","gTo","bTo","lerp","floor","linearColorForValue","stepColorForValue","sourceMin","sourceMax","targetMin","targetMax","legendLength","placeLegend","svgMake","settings","container","defs","weathermapID","transform","strokeLegendContainer","appendChild","setAttribute","width","drawLegend","fillLegendContainer","showLegendLabel","xCoord","yCoord","dy","textAnchor","label","text","textContent","placeLabels","legendGradientName","svgGrad","linearGradient","svgStop","stop","svgRect","rect","setRectangleDimensions","renderWeathermapInto","elementCreator","config","currentValues","linkResolver","addViewBox","sortedStops","slice","sort","l","sortedGradient","state","WeathermapRendererState","svg","make","modifyStyle","canvasSize","height","legendGroup","edgeGroup","nodeGroup","labelGroup","initializeSVG","nodeLinkUriBase","link","node","edgeLinkUriBase","edge","weathermapNodes","nodeLabelToNode","singleNodeGroup","maybeWrapIntoLink","linkParams","textOffsets","left","bottom","showNumbers","metricName","currentValue","noValueDashArray","unmeasuredDashArray","titleElem","title","insertBefore","firstChild","toFixed","placeNodes","weathermapEdges","node1","node2","singleEdgeGroup","n1Center","n2Center","bendDirection","bendMagnitude","n1N2Angle","atan2","n2N1Angle","n1N2BendAngle","n2N1BendAngle","control1Offset","control2Offset","metric2Name","point1COut","point2CIn","point2COut","point3CIn","makeAndPlaceEdge","styleName","placeEdges","weathermapLabels","singleLabelGroup","legend","id","start","end","edgeStyleName","strokeWidths","strokeWidth","edgeStyle","style","styleMap","getWeathermapStyle","strokeWidthArray","split","map","p","parseFloat","push","vector","euclidNorm","offsetUnitVector","direction","sqrt","multistrokeGroup","element","styleProps","dashArray","modifyApplyingWeathermapStyle","currentOffset","reduce","acc","cur","isSpacing","xOffset","yOffset","strokeStart","strokeControl1","strokeControl2","strokeEnd","path","valueString","upperGroup","singleObjectGroup","linkUriBase","objLinkParams","objLinkUri","indexOf","aElement","a","setAttributeNS","newValues","assembledStyle","hasAttribute","styleVal","getAttribute","chunk","index","key","hasOwnProperty","keyValuePairs","keyValueString","join","domCreator","this","SVGElementCreator","weathermapStyles","name","maker","createElementNS","require","fetchMetrics","baseUrl","metrics","lookback_interval","agent","metricValueMap","metric","metricQueryEscaped","encodeURIComponent","expr","replace","httpGetAsync","metricUrl","URL","protocol","hostname","port","pathname","search","response","body","metricData","JSON","parse","data","result","labels","interpolateLabels","legendFormat","destroy","template","output","nextBracesIndex","endBracesIndex","variableName","variableValue","Promise","resolve","reject","options","req","res","on","err","configFile","outputFile","printUsage","console","error","main","awaiting","process","argv","arg","processOptions","encoding","exitCode","configString","weathermap","targets","dataSources","lookbackInterval","styleDefinition","dataSource","datasource","Array","isArray","uid","metricValues","impl","doc","createDocument","svgStyle","firstElementChild","outputter","outputString","serializeToString","writeFileAsync","freeze","object","oc","undefined","Object","MIME_TYPE","HTML","isHTML","XML_APPLICATION","XML_TEXT","XML_XHTML_APPLICATION","XML_SVG_IMAGE","NAMESPACE","uri","SVG","XML","XMLNS","exports","assign","target","source","TypeError","prototype","call","conventions","dom","entities","sax","DOMImplementation","ParseError","XMLReader","normalizeLineEndings","input","DOMParser","locator","DOMHandler","cdata","lineNumber","columnNumber","_locator","systemId","_toString","chars","java","lang","String","appendElement","hander","currentElement","parseFromString","mimeType","domBuilder","errorHandler","defaultNSMap","xmlns","test","entityMap","HTML_ENTITIES","XML_ENTITIES","setDocumentLocator","errorImpl","isCallback","Function","build","fn","msg","buildErrorHandler","xml","normalize","startDocument","documentURI","startElement","namespaceURI","localName","qName","attrs","el","len","getURI","getValue","attr","getQName","createAttributeNS","getLocator","nodeValue","setAttributeNode","endElement","current","tagName","parentNode","startPrefixMapping","prefix","endPrefixMapping","processingInstruction","ins","createProcessingInstruction","ignorableWhitespace","ch","characters","apply","arguments","charNode","createCDATASection","createTextNode","skippedEntity","endDocument","comment","comm","createComment","startCDATA","endCDATA","startDTD","publicId","implementation","createDocumentType","dt","doctype","warning","warn","fatalError","notEmptyString","orderedSetReducer","toOrderedSet","list","filter","splitOnASCIIWhitespace","keys","copy","src","dest","_extends","Class","Super","pt","t","constructor","NodeType","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","ExceptionCode","ExceptionMessage","HIERARCHY_REQUEST_ERR","INDEX_SIZE_ERR","DOMSTRING_SIZE_ERR","NOT_FOUND_ERR","WRONG_DOCUMENT_ERR","INVALID_CHARACTER_ERR","NO_DATA_ALLOWED_ERR","NO_MODIFICATION_ALLOWED_ERR","INUSE_ATTRIBUTE_ERR","NOT_SUPPORTED_ERR","INVALID_STATE_ERR","SYNTAX_ERR","INVALID_MODIFICATION_ERR","NAMESPACE_ERR","INVALID_ACCESS_ERR","DOMException","code","message","Error","captureStackTrace","NodeList","LiveNodeList","refresh","_node","_refresh","_updateLiveList","inc","_inc","ownerDocument","ls","__set__","NamedNodeMap","_findNodeIndex","_addNamedNode","newAttr","oldAttr","ownerElement","_onRemoveAttribute","_nsMap","_onAddAttribute","_removeNamedNode","lastIndex","Node","_xmlEncoder","c","charCodeAt","_visitNode","callback","nextSibling","Document","remove","_onUpdateChild","newChild","cs","childNodes","child","_removeChild","previous","previousSibling","next","lastChild","_insertBefore","nextChild","cp","removeChild","nodeType","newFirst","newLast","pre","Element","Attr","CharacterData","Text","Comment","CDATASection","DocumentType","Notation","Entity","EntityReference","DocumentFragment","ProcessingInstruction","XMLSerializer","nodeSerializeToString","isHtml","nodeFilter","buf","refNode","documentElement","lookupPrefix","visibleNamespaces","namespace","needNamespaceDefine","ns","addSerializedAttribute","qualifiedName","attributes","nodeName","prefixedNodeName","defaultNS","ai","item","nsi","pubid","sysid","sub","internalSubset","importNode","deep","cloneNode","n","v","attrs2","_ownerElement","toString","getNamedItem","setNamedItem","setNamedItemNS","getNamedItemNS","removeNamedItem","removeNamedItemNS","hasFeature","feature","version","root","refChild","replaceChild","oldChild","hasChildNodes","appendData","isSupported","hasAttributes","lookupNamespaceURI","isDefaultNamespace","importedNode","getElementById","rtv","getElementsByClassName","classNames","classNamesSet","base","nodeClassNames","matches","nodeClassNamesSet","every","createElement","createDocumentFragment","createAttribute","specified","createEntityReference","pl","getAttributeNode","removeAttribute","removeAttributeNode","_appendSingleChild","setAttributeNodeNS","removeAttributeNS","old","getAttributeNodeNS","hasAttributeNS","getAttributeNS","getElementsByTagName","getElementsByTagNameNS","substringData","offset","count","substring","insertData","replaceData","deleteData","splitText","newText","newNode","defineProperty","getTextContent","get","$$length","set","e","amp","apos","gt","lt","quot","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","times","divide","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","prop","infin","ang","and","or","cap","cup","there4","sim","cong","asymp","ne","equiv","le","ge","sup","nsub","sube","supe","oplus","otimes","perp","sdot","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","euro","trade","larr","uarr","rarr","darr","harr","crarr","lceil","rceil","lfloor","rfloor","loz","spades","clubs","hearts","diams","nameStartChar","nameChar","RegExp","tagNamePattern","copyLocator","f","parseElementStartPart","currentNSMap","entityReplacer","addAttribute","qname","startIndex","attributeNames","addValue","attrName","s","charAt","setTagName","closed","match","localNSMap","nsp","nsPrefix","_copy","parseHtmlSpecialContent","elStartEnd","elEndStart","fixSelfClosed","closeMap","pos","lastIndexOf","parseDCC","matchs","exec","lastMatch","endDTD","parseInstruction","ElementAttributes","defaultNSMapCopy","fixedFromCharCode","surrogate1","surrogate2","fromCharCode","k","appendText","xt","m","lineEnd","linePattern","lineStart","parseStack","tagStart","pop","endMatch","toLowerCase","locator2","max","getLocalName","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","d","definition","o","enumerable","obj","Symbol","toStringTag"],"sourceRoot":""}